[{"id":"7946cdcdd74bfc50bffd88db84a2af16","title":"å¥¹æ˜¯è°","content":"","slug":"dream-240927","date":"2024-09-28T10:16:00.000Z","categories_index":"Emo","tags_index":"emo,dream","author_index":"RaphaelNY"},{"id":"2818dcba97ab21b0acb9e104daddb083","title":"vscode macOS to Windows","content":"å‰è¨€\n\n\n\n\n\n\n\n\nå‰æ®µæ—¶é—´ï¼Œä¸ºäº†æ–¹ä¾¿åŠå…¬ï¼Œæˆ‘å°è¯•å°†macOSçš„vscodeå·¥ä½œåŒºé“¾æ¥åˆ°Windowsçš„è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿åœ¨macOSä¸Šç¼–å†™ä»£ç ï¼Œç„¶ååœ¨Windowsä¸Šè¿è¡Œä»£ç ã€‚é¿å…åœ¨macOSä¸Šå®‰è£…Windowsçš„å¼€å‘ç¯å¢ƒï¼Œä»¥åŠä¸éœ€è¦æŠŠä»£ç æ”¾åœ¨MacOSä¸­ç¼–è¯‘è¿è¡Œï¼ˆä½ ä»¬éƒ½çŸ¥é“çš„ï¼ŒAppleçš„ç¡¬ç›˜å†…å­˜å–çš„æ¯”é‡‘å­è¿˜è´µï¼‰ã€‚ä½†æ˜¯åœ¨å°è¯•çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè®°å½•å¦‚ä¸‹ã€‚\né—®é¢˜\n\n\n\n\n\n\n\n\nåŒ…å«sshå®‰è£…ï¼Œé…ç½®ï¼Œå¯†é’¥è®¤è¯ç­‰ç›¸å…³å†…å®¹è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»ï¼Œç½‘ç»œä¸Šéšä¾¿ä¸€æœå°±æœ‰å¾ˆå¤šæ•™ç¨‹äº†ã€‚\n1. é€šè¿‡sshè¿æ¥åˆ°Windows\né€šè¿‡sshè¿æ¥åˆ°Windowsï¼Œå¯ä»¥æ­£å¸¸è¿æ¥ï¼Œä½†æ˜¯åœ¨vscodeä¸­æ‰“å¼€å·¥ä½œåŒºæ—¶ï¼Œä¼šäº§ç”ŸæŠ¥é”™ï¼Œä¸€èˆ¬æ˜¯ssh Connection time out\nä¸€ç§å¯èƒ½çš„é—®é¢˜æ˜¯ç”±äºWindowsçš„é˜²ç«å¢™å¯¼è‡´çš„ï¼Œéœ€è¦åœ¨Windowsçš„é˜²ç«å¢™ä¸­æ·»åŠ ä¸€ä¸ªå…¥ç«™è§„åˆ™å¼€æ”¾22ç«¯å£ï¼Œå…è®¸sshè¿æ¥ã€‚\nå¦ä¸€ç§å¯èƒ½æ˜¯ç”±äºWindowsçš„sshæœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œéœ€è¦åœ¨Windowsçš„æœåŠ¡ä¸­å¯åŠ¨sshæœåŠ¡ã€‚\né™¤å»ä¸Šé¢çš„ä¸¤ç§é—®é¢˜ï¼Œå°±æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸åŒäº†ã€‚\n\n\nåœ¨æ–°ç‰ˆçš„vscodeä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªé…ç½®ï¼Œä½ å¯ä»¥åœ¨è®¾ç½®ä¸­æœç´¢Remote.SSH.UserLocalServer,åœ¨ä¹‹å‰ä½¿ç”¨windowsé“¾æ¥LinuxæœåŠ¡å™¨æ—¶ï¼Œéƒ½æ²¡å‡ºç°è¿‡sshçš„é—®é¢˜ï¼Œåœ¨ç¬¬ä¸€æ¬¡é“¾æ¥çš„æ—¶å€™ä¼šè¯¢é—®è·å–ç›®æ ‡æœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿï¼Œå¦‚æœä½ é€‰æ‹©äº†é”™è¯¯çš„æ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´sshè¿æ¥å¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™ä½ éœ€è¦åœ¨vscodeçš„è®¾ç½®ä¸­æ‰‹åŠ¨ä¿®æ”¹è¿™ä¸ªé…ç½®é¡¹ã€‚ä½†æ˜¯åœ¨æˆ‘å°è¯•çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªé…ç½®é¡¹å¹¶æ²¡æœ‰å‡ºç°ï¼ˆåˆæˆ–è€…å‡ºç°äº†ï¼Œä½†æˆ‘è‚¯å®šæˆ‘é€‰æ‹©çš„æ˜¯æ­£ç¡®çš„ï¼‰ï¼Œvscodeåœ¨åç»­æˆ‘æµ‹è¯•çš„æ¯æ¬¡å°è¯•ä¸­ï¼Œéƒ½åœ¨å»ºç«‹sshé“¾æ¥ä¹‹åå°è¯•åœ¨æˆ‘çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šè¿è¡Œuname -rsvå‘½ä»¤ï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤åœ¨Windowsä¸Šé»˜è®¤æ˜¯ä¸æ”¯æŒçš„ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´vscodeåˆ¤å®šå·¥ä½œåŒºæ— æ³•å»ºç«‹ã€‚\nåœ¨ç½‘ç»œä¸Šè¿›è¡Œäº†å¤šæ¬¡æŸ¥è¯¢å’Œæˆ‘è‡ªå·±å¯¹è®¾ç½®çš„ç›¸å…³è°ƒè¯•åï¼Œæœ€ç»ˆæˆ‘é€šè¿‡ç›´æ¥å…³é—­æœ¬æœºä¸Šçš„Remote.SSH.UserLocalServerè¿™ä¸ªé…ç½®é¡¹å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç›¸æ¯”äºå…¶ä»–å¤æ‚çš„ä¿®æ”¹windowsçš„é…ç½®ï¼Œè¿™ä¸ªæ–¹æ³•æ›´åŠ ç®€å•ï¼ˆå¤§å®¶éƒ½çŸ¥é“ï¼Œwindowsçš„ç¯å¢ƒæ˜¯å‡ºäº†åçš„å¤æ‚éº»çƒ¦ï¼‰ã€‚\n\n2. é€šè¿‡sshè¿æ¥åˆ°Windowsåå°è¯•æäº¤ä»£ç å¤±è´¥ï¼ˆä¸»è¦æ˜¯å…³äºgpgçš„å†…å®¹ï¼‰\nå¯ä»¥å‚è€ƒè¿™ä¸ªåšä¸»çš„è¯¦ç»†æ•™ç¨‹\nå¦ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨æˆ‘åœ¨è¿™è¾¹é…ç½®ç»“æŸä¹‹åå›åˆ°windowsä¸Šå°è¯•æäº¤å‘ç°æˆ‘çš„windowsä¸Šçš„é…ç½®ä¹Ÿå‡ºç°äº†é—®é¢˜ï¼Œä¹‹å‰ä¸€ç›´éƒ½èƒ½å¤Ÿæ­£å¸¸æäº¤ã€‚ä¸è¿‡åœ¨ä¿®æ­£äº†git configä¹‹åï¼Œå°±å¯ä»¥æ­£å¸¸æäº¤äº†ã€‚å‡ºç°åŸå› ä¸æ˜ã€‚\nè°¨æ…ä¿®æ”¹é…ç½®ï¼Œmacçš„vscodeè¿windowsç»™æˆ‘windowsçš„gpgå¹²æ­»äº†ï¼Œä¿®äº†åŠå¤©ã€‚\n\n","slug":"vscode-macOS-to-Windows","date":"2024-09-18T02:29:32.000Z","categories_index":"VSCode,macOS,Windows","tags_index":"vscode,ssh","author_index":"RaphaelNY"},{"id":"08ab197663d22426d8804f0a11a49fec","title":"Solana Anchoræ¡†æ¶ ç¼–ç¨‹å­¦ä¹ ","content":"å‰è¨€\n\n\n\n\n\n\n\n\nå…ˆåœ¨è¿™é‡Œå¼€ä¸ªå‘ï¼Œè¿™ç®—æ˜¯å­¦ä¹ é¢„å‘Šï¼ŸğŸ˜‹\n","slug":"Anchor-learning","date":"2024-09-03T14:00:00.000Z","categories_index":"Rust,åŒºå—é“¾","tags_index":"rust,solana,Anchor","author_index":"RaphaelNY"},{"id":"40e410b5347e58401e54ab5e8d97a4e6","title":"ç†Ÿæ‚‰zinoæ¡†æ¶","content":"introè¿™æ¬¡å‡†å¤‡åŸºäºzinoå®˜æ–¹çš„example/actix-appæ¥è¿›è¡Œå­¦ä¹ ï¼Œè¿›è¡Œä»£ç é˜…è¯»å¹¶å‚ç…§zinoå¼€å‘æ–‡æ¡£è¿›è¡Œå­¦ä¹ è®°å½•ã€‚\nä»exampleå¼€å§‹ç†Ÿæ‚‰zinoæ¡†æ¶123456å¼€å‘ç¯å¢ƒï¼šwindows11rustup 1.27.1rustc 1.84.0postrageSQLæ›´å¤šé…ç½®å‚ç…§cargo.toml\n\né€šè¿‡actix-app äº†è§£zinoæ¡†æ¶\næ–‡ä»¶ç›®å½•æ ¼å¼å‚ç…§ï¼šç›®å½•ç»“æ„ - Zinoå¼€å‘æ¡†æ¶ä¸­æ–‡æ•™ç¨‹\n\nä½¿ç”¨ç±»ä¼¼äºEgg.jsçš„åº”ç”¨ç›®å½•çº¦å®šè§„èŒƒ\n\n\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657zino-appâ”œâ”€ Cargo.tomlâ”œâ”€ configâ”‚  â”œâ”€ config.dev.tomlâ”‚  â”œâ”€ config.prod.tomlâ”‚  â”œâ”€ localeâ”‚  â”‚  â”œâ”€ en-US.ftlâ”‚  â”‚  â””â”€ zh-CN.ftlâ”‚  â”œâ”€ opaâ”‚  â”‚  â””â”€ user.opaâ”‚  â””â”€ openapiâ”‚     â”œâ”€ OPENAPI.tomlâ”‚     â”œâ”€ auth.tomlâ”‚     â””â”€ user.tomlâ”œâ”€ localâ”‚  â”œâ”€ dataâ”‚  â”‚  â””â”€ mockâ”‚  â”‚     â”œâ”€ logs.ndjsonâ”‚  â”‚     â””â”€ users.csvâ”‚  â””â”€ docsâ”‚     â””â”€ rapidoc.htmlâ”œâ”€ logsâ”œâ”€ publicâ”‚  â”œâ”€ 404.htmlâ”‚  â”œâ”€ dataâ”‚  â”‚  â””â”€ logs.ndjsonâ”‚  â””â”€ index.htmlâ”œâ”€ srcâ”‚  â”œâ”€ controllerâ”‚  â”‚  â”œâ”€ mod.rsâ”‚  â”‚  â”œâ”€ stats.rsâ”‚  â”‚  â”œâ”€ task.rsâ”‚  â”‚  â””â”€ user.rsâ”‚  â”œâ”€ extensionâ”‚  â”‚  â”œâ”€ casbin.rsâ”‚  â”‚  â”œâ”€ header.rsâ”‚  â”‚  â””â”€ mod.rsâ”‚  â”œâ”€ logicâ”‚  â”‚  â”œâ”€ mod.rsâ”‚  â”‚  â”œâ”€ task.rsâ”‚  â”‚  â””â”€ user.rsâ”‚  â”œâ”€ main.rsâ”‚  â”œâ”€ middlewareâ”‚  â”‚  â”œâ”€ access.rsâ”‚  â”‚  â””â”€ mod.rsâ”‚  â”œâ”€ routerâ”‚  â”‚  â””â”€ mod.rsâ”‚  â”œâ”€ scheduleâ”‚  â”‚  â”œâ”€ job.rsâ”‚  â”‚  â””â”€ mod.rsâ”‚  â””â”€ serviceâ”‚     â”œâ”€ mod.rsâ”‚     â”œâ”€ task.rsâ”‚     â””â”€ user.rsâ””â”€ templates   â”œâ”€ layout.html   â””â”€ output.html\n\n\nCargo.tomlä¸ºåº”ç”¨çš„Cargoé…ç½®æ–‡ä»¶ã€‚\nconfig/config.&#123;env&#125;.tomlç”¨äºç¼–å†™ä¸åŒè¿è¡Œç¯å¢ƒçš„é…ç½®æ–‡ä»¶ã€‚\nconfig/locale/&#123;lang-id&#125;.ftläºç¼–å†™i18nå¤šè¯­è¨€æ–‡ä»¶ï¼Œç›®å‰ä»…æ”¯æŒFluentè§„èŒƒã€‚\nconfig/opa/&#123;policy&#125;.regoç”¨äºç¼–å†™OpenPolicyAgentç­–ç•¥ã€‚\nconfig/openapi/&#123;tag&#125;.tomlç”¨äºç¼–å†™OpenAPIè§„èŒƒæ–‡æ¡£ã€‚\nlocal/ä¸ºæœ¬åœ°é™æ€èµ„æºç›®å½•ï¼Œdata/ä¸ºæœ¬åœ°æ•°æ®ç›®å½•ï¼Œdocs/ä¸ºæ–‡æ¡£ç›®å½•ã€‚\nlogs/ç”¨äºæ—¥å¿—æ–‡ä»¶è¾“å‡ºã€‚\npublic/ä¸ºé€šè¿‡ç½‘ç»œè®¿é—®çš„é™æ€èµ„æºç›®å½•ï¼Œindex.htmlä¸ºé»˜è®¤é¦–é¡µæ–‡ä»¶ï¼Œ404.htmlä¸º404æ–‡ä»¶ï¼Œdata/ä¸ºå…±äº«çš„æ•°æ®ç›®å½•ã€‚\nsrc/controller/ç”¨äºç¼–å†™æ§åˆ¶å™¨ã€‚\nsrc/extension/ç”¨äºç¼–å†™è¾…åŠ©å‡½æ•°ã€‚\nsrc/logic/ç”¨äºç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚\nsrc/main.rsç”¨äºå¯åŠ¨åº”ç”¨ä»¥åŠè‡ªå®šä¹‰åˆå§‹åŒ–ã€‚\nsrc/middleware/ç”¨äºç¼–å†™ä¸­é—´ä»¶ã€‚\nsrc/router/ç”¨äºé…ç½®URLè·¯ç”±è§„åˆ™ã€‚\nsrc/schedule/ç”¨äºç¼–å†™å®šæ—¶ä»»åŠ¡ã€‚\nsrc/service/ç”¨äºç¼–å†™ä¸šåŠ¡æ¥å£æœåŠ¡ï¼Œä¾›controllerè°ƒç”¨ã€‚\ntemplates/ç”¨äºç¼–å†™HTMLæ¨¡æ¿æ–‡ä»¶ï¼Œç›®å‰æ”¯æŒTeraå’ŒMiniJinjaæ¨¡æ¿ã€‚\n\n\né…ç½®æ–‡ä»¶é¦–å…ˆæ˜¯configä¸‹é…ç½®çš„config.{env}.tomlæ–‡ä»¶\nzinoæ¡†æ¶æä¾›äº†å¯ä¾›ä¿®æ”¹çš„configé…ç½®æ–‡ä»¶æ¥æ–¹ä¾¿è®¾å®šç›¸å…³æœåŠ¡ä¿¡æ¯ä»è€Œè§„é¿éœ€è¦ç›´æ¥å¯¹ä»£ç è¿›è¡Œä¿®æ”¹åé‡æ–°ç¼–è¯‘çš„å¼€é”€ã€‚\n\nname,versioné…ç½®åº”ç”¨åç§°å’Œç‰ˆæœ¬å·\nmainæœåŠ¡ï¼Œdebugä»¥åŠå¤‡ç”¨standbyæœåŠ¡å‡å¯ä»¥å•ç‹¬æŒ‡å®šhostä»¥åŠportï¼Œæ”¯æŒä½¿ç”¨tagæ ‡è¯†\næ•°æ®åº“ç›¸å…³é…ç½®ä¸º[database] [[postgres]] [[sqlite]]ã€‚å¯ä»¥å°†postgresæ›¿æ¢ä¸ºéœ€æ±‚çš„æ•°æ®åº“ï¼Œå…·ä½“æ•°æ®åº“æ”¯æŒè¯·å‚ç…§zinoçš„ç›¸å…³æ–‡æ¡£ã€‚\nå…¶ä»–é‡è¦é…ç½®ï¼ŒåŒ…æ‹¬æ—¥å¿—è¿½è¸ªã€æŒ‡æ ‡ç›‘æ§prometheusã€jwtè®¤è¯ã€apiæ–‡æ¡£é…ç½®ç­‰å‚è€ƒå®é™…æ–‡ä»¶ã€‚\n\nç¤ºä¾‹ï¼š\n123456789101112131415[database]namespace = &quot;dc&quot;max-rows = 10000    # æœ€å¤§è¡Œæ•°é™åˆ¶# PostgreSQL é…ç½®[[postgres]]host = &quot;127.0.0.1&quot;port = 5432database = &quot;data_cube&quot;username = &quot;postgres&quot;password = &quot;...&quot;    # æ•°æ®åº“å¯†ç # SQLite é…ç½®[[sqlite]]database = &quot;local/data/main.db&quot;\n\næ—¥å¿—æ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—æ–‡ä»¶logå°†åœ¨logsæ–‡ä»¶å¤¹ä¸‹è¿›è¡Œä¿å­˜ï¼Œå‘½åæ–¹å¼ä¸º&#123;name&#125;.&#123;env&#125;.&#123;time&#125;.log\npubliczinoæ¨èå°†å‰ç«¯é™æ€èµ„æºæ”¾ç½®åœ¨publicé‡Œé¢ï¼Œåœ¨é¡¹ç›®è¿ç§»æ—¶ï¼Œæ‰€æœ‰å‰ç«¯èµ„æºéƒ½å°†è¢«é˜²æ­¢åœ¨publicä¸­è¿›è¡Œç»„ç»‡ã€‚æ‚¨å¯ä»¥åœ¨src/routerä¸­è¿›è¡Œè·¯ç”±é…ç½®\n\nsrcå‚è€ƒå‰æ–‡æä¾›çš„æ–‡ä»¶ç›®å½•æ¶æ„ï¼Œæ¥ç†Ÿæ‚‰ä»¥ä¸‹zinoæ¡†æ¶ä¸‹çš„åç«¯ä»£ç ç»„ç»‡ã€‚æœ¬æ¬¡å­¦ä¹ å‚ç…§çš„æ˜¯example/actix-appä½œä¸ºæ ‡å‡†ä»£ç ã€‚ä¸‹é¢åŸºäºä¸€èˆ¬æ€§çš„åŸºç¡€éœ€æ±‚è¿›è¡Œå­¦ä¹ ã€‚\n\n\n\n\n\n\n\n\n\nsrc/controller/ç”¨äºç¼–å†™æ§åˆ¶å™¨ã€‚src/extension/ç”¨äºç¼–å†™è¾…åŠ©å‡½æ•°ã€‚src/logic/ç”¨äºç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚src/main.rsç”¨äºå¯åŠ¨åº”ç”¨ä»¥åŠè‡ªå®šä¹‰åˆå§‹åŒ–ã€‚src/middleware/ç”¨äºç¼–å†™ä¸­é—´ä»¶ã€‚src/router/ç”¨äºé…ç½®URLè·¯ç”±è§„åˆ™ã€‚src/schedule/ç”¨äºç¼–å†™å®šæ—¶ä»»åŠ¡ã€‚src/service/ç”¨äºç¼–å†™ä¸šåŠ¡æ¥å£æœåŠ¡ï¼Œä¾›controllerè°ƒç”¨ã€‚\ndomain extension logic serviceåœ¨æœ¬é¡¹ç›®ä¸­ï¼Œç”±äºåªå®ç°ä¸€äº›ååˆ†ç®€å•çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ç›¸å…³è¿™éƒ¨åˆ†çš„ä»£ç å¯ä¾›å‚è€ƒï¼Œåœ¨æ­¤ç•™ç©ºï¼Œå¾…ç¬”è€…å­¦æˆå½’æ¥ã€‚ç†è§£ä¸Šï¼Œserviceå¤§æ¦‚ç±»ä¼¼äºcontrollerä¸­çš„éƒ¨åˆ†åŠŸèƒ½æ‹†åˆ†ï¼Œä¼˜åŒ–ä»£ç æ„ç­‘å’Œä»£ç å¯è¯»æ€§ã€‚\n\n\n\n\n\n\n\nWARNING\n\n\nrouterrouterä¸‹åªä½¿ç”¨äº†ä¸€ä¸ªmodæ–‡ä»¶æ¥å­˜æ”¾æ•´ä¸ªé¡¹ç›®çš„è·¯ç”±ä¿¡æ¯ã€‚\nä½¿ç”¨RESTfulAPIçš„é£æ ¼è®¾è®¡\nzinoæ¡†æ¶ä¸‹çš„è·¯ç”±å®ç°ä½ å¯ä»¥æ ¹æ®ä½¿ç”¨çš„æ¡†æ¶è‡ªè¡Œè°ƒæ•´ï¼Œä¸‹é¢æ˜¯aticxçš„å®ç°æ–¹å¼ï¼Œä½ ä½¿ç”¨axumçš„æ„å»ºå½¢å¼ï¼Œé€šè¿‡å½¢å¦‚ä¸‹è¿°è¿›è¡Œå®ç°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n12345678910111213141516pub fn routes() -&gt; Vec&lt;Router&gt; &#123;    let mut routes = Vec::new();    // Auth controller.    let router = Router::new().route(&quot;/auth/login&quot;, post(auth::login)).merge(        Router::new()            .route(&quot;/auth/refresh&quot;, get(auth::refresh))            .route(&quot;/auth/logout&quot;, post(auth::logout))            .layer(from_fn(middleware::init_user_session)),    );    routes.push(router);        ...        routes&#125;\n\nç”±äºzinoå…¼å®¹äº†ä¸»æµrustçš„å¤´éƒ¨æ¡†æ¶ï¼Œä½ å¯ä»¥åœ¨ä»£ç å¼€å¤´çœ‹åˆ°use actix_web::web::&#123;&#125;;\n\nä½¿ç”¨routes()å’Œdebug_routes()æ•´åˆæ•´ä¸ªè·¯ç”±é…ç½®æ‹†åˆ†ä¸ºä¸»è¦è·¯ç”±å’Œè°ƒè¯•è·¯ç”±ã€‚ä¸»è¦åŠŸèƒ½å°±æ˜¯æŠŠæˆ‘ä»¬å‡†å¤‡çš„å„ç§ä¸åŒåŠŸèƒ½çš„è·¯ç”±åˆ†ç»„æ‰“åŒ…æˆvecã€‚\n\nä»£ç ä¸­ä½¿ç”¨äº†å½¢å¦‚auth_router as RouterConfigureçš„è¯­å¥ï¼Œå‚ç…§RouterConfigureæºç pub type RouterConfigure = fn(cfg: &amp;mut actix_web::web::ServiceConfig);\nå¯çŸ¥RouterConfigureæ˜¯ç±»å‹åˆ«åï¼Œå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ç±»å‹ã€‚\næ¥æ”¶ä¸€ä¸ªå¯å˜å¼•ç”¨&amp;mut actix_web::web::ServiceConfig\nè¿”å›ç©º\n\n\n\n\nå…·ä½“è·¯ç”±æ–¹é¢ï¼Œè·¯ç”±ä½¿ç”¨.wrap(middleware::WserSessionInitializer),ä¸ºéœ€è¦ä¼šè¯éªŒè¯çš„éƒ¨åˆ†æŒ‡å®šä½¿ç”¨ä¼šè¯ä¸­é—´ä»¶è¿›è¡Œä¼šè¯éªŒè¯\n\nrustfn auth_router(cfg: &amp;mut ServiceConfig) &#123;\n    // ä¸éœ€è¦ä¼šè¯éªŒè¯çš„è·¯ç”±\n    cfg.route(&quot;/auth/login&quot;, post().to(auth::login));\n    \n    // éœ€è¦ä¼šè¯éªŒè¯çš„è·¯ç”±ç»„\n    cfg.service(\n        scope(&quot;/auth&quot;)\n            .route(&quot;/refresh&quot;, get().to(auth::refresh))\n            .route(&quot;/logout&quot;, post().to(auth::logout))\n            .wrap(middleware::UserSessionInitializer),  // æ·»åŠ ä¼šè¯ä¸­é—´ä»¶\n    );\n&#125;\n&lt;!--codeï¿¼4--&gt;\n\n- åŒºåˆ†controlleræ–¹æ³•å’Œmodelæ–¹æ³•\nåœ¨modä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ†åˆ«è°ƒç”¨äº†Userå’Œuserï¼Œé‡Œé¢æ¶‰åŠåˆ°ä½¿ç”¨äº†zinoæ¡†æ¶æä¾›çš„defaultæ–¹æ³•å’Œè‡ªå·±å®ç°çš„æ–¹æ³•ï¼Œç­‰çœ‹åˆ°controllerçš„ä»£ç ä¹‹åå†è¿›è¡Œè§£å†³\n\n\n\n\n\n\n\n\n\nWARNING\n\n\nmiddlewaremiddlewareä¸­ä¸»è¦å®šä¹‰äº†ä¸€ä¸ªç”¨äºå¤„ç†JwtéªŒè¯çš„ä¼šè¯ä¸­é—´ä»¶\nUserSessionInitializerä¸­é—´ä»¶åˆå§‹åŒ–å™¨ï¼Œå®ç°äº†Transform Traitï¼Œ\n\nåœ¨Transform traitä¸­ï¼Œtypeçš„éƒ¨åˆ†å®šä¹‰çš„æ˜¯transformçš„å…³è”ç±»å‹\n\nnew_transformæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå®ç°äº†Sè¦æ±‚traitå’Œselfï¼Œè¿”å›å‰é¢å®šä¹‰çš„Futureå…³è”ç±»å‹\n\nS å…¶å®å°±æ˜¯æœåŠ¡ç±»å‹çš„æ³›å‹,æ ‡è¯†å®é™…è¯·æ±‚çš„æœåŠ¡\nBæ˜¯å“åº”ä½“çš„ç±»å‹ï¼Œé€šå¸¸æ˜¯å­—èŠ‚æµæˆ–è€…å…¶ä»–å†…å®¹\nServiceRequestæ˜¯è¯·æ±‚ç±»å‹ï¼Œä»–ä¼šä¼ é€’ç»™è¿™ä¸ªä¸­é—´ä»¶\nS: Service&lt;ServiceRequest, Response = ServiceResponse&lt;B&gt;, Error = Error&gt;: è¿™éƒ¨åˆ†çº¦æŸæŒ‡å®šäº†æœåŠ¡ S å¿…é¡»æ˜¯ä¸€ä¸ªèƒ½å¤Ÿæ¥å— ServiceRequest è¯·æ±‚å¹¶è¿”å› ServiceResponse&lt;B&gt; å“åº”çš„æœåŠ¡ï¼Œè€Œä¸”å¿…é¡»èƒ½å¤Ÿå¤„ç† Error é”™è¯¯\nS::Future: &#39;static: è¿™è¡¨ç¤º S æœåŠ¡çš„ Future è¿”å›ç±»å‹å¿…é¡»æ˜¯ &#39;staticï¼Œå³ä¸ä¼šåŒ…å«ç”Ÿå‘½å‘¨æœŸä¾èµ–äºå±€éƒ¨å˜é‡çš„å¼•ç”¨\n\n\ntype Transform = UserSessionMiddleware&lt;S&gt;;è¿™æ˜¯ä¸­é—´ä»¶æœ€ç»ˆäº§ç”Ÿçš„ç±»å‹ã€‚åœ¨è¿™ä¸ªå®ç°ä¸­ï¼ŒTransform ç±»å‹æ˜¯ UserSessionMiddleware&lt;S&gt;ï¼Œè¿™æ„å‘³ç€è¯¥ä¸­é—´ä»¶ä¼šè¿”å›ä¸€ä¸ª UserSessionMiddleware ç±»å‹çš„å¯¹è±¡ï¼Œå®ƒæœ¬è´¨ä¸ŠåŒ…è£¹äº†åŸå§‹çš„æœåŠ¡ S\n\nnew_transformç”¨äºå®é™…è½¬æ¢æœåŠ¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ä¸­é—´ä»¶å®ä¾‹\n\né€šè¿‡UserSessionMiddlewareæ‰“åŒ…serviceæœåŠ¡å¹¶ä½œä¸ºreadyç±»å‹çš„Futureè¿”å›ã€‚FutureåŒ…å«Ok(UserSessionMiddleware)ä½œä¸ºç»“æœ\n\n\n\nUserSessionMiddlewareç”¨äºå¤„ç†è¯·æ±‚ï¼Œè§£æJWTï¼Œå¹¶è®¾ç½®ç”¨æˆ·ä¼šè¯ã€‚\n\ntype Future =   Pin&lt;box&lt;dyn Future&lt;Output = Result&lt;Self::Response, Self::Error&gt;&gt;&gt;&gt;;\nè¿™æ˜¯callæ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œä»£è¡¨ä¸­é—´ä»¶çš„å¼‚æ­¥æ‰§è¡Œç»“æœã€‚\nPine&lt;Box&lt;dyn Future&lt;...&gt;&gt;&gt;ç”¨æ¥åŒ…è£¹Futureæ¥æ»¡è¶³å¼‚æ­¥æ“ä½œå’ŒåŠ¨æ€åˆ†é…çš„éœ€æ±‚ã€‚\nforward_ready!(service);è¿™æ˜¯ Actix Web ä¸­é—´ä»¶çš„å®ï¼Œç”¨äºå°†æœåŠ¡ service çš„ ready çŠ¶æ€è½¬å‘ã€‚å®ƒç¡®ä¿åœ¨ä¸­é—´ä»¶ä¸­ï¼Œready çŠ¶æ€çš„åˆ¤æ–­å’Œè½¬å‘æ­£ç¡®ï¼Œå…è®¸ä¸­é—´ä»¶å°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡\n\n\nlet mut req: Extractor&lt;HttpRequest&gt; =  Request::from(req);å°†Actix-webçš„ServiceRequestè½¬æ¢ä¸ºzino::Request,ç”¨äºåç»­è°ƒç”¨zinoä¸­çš„ç›¸å…³æ–¹æ³•\nreq.parse_jwt_claims(JwtClaims::shared_key())è§£æJwtï¼Œè·å–å…±äº«å¯†é’¥ï¼Œè§£æå¹¶æå–å£°æ˜\nè§£ææˆåŠŸå¹¶è¿”å›Jwtå£°æ˜ï¼Œå¯ä»¥è½¬æ¢ä¸ºUserSessionï¼ˆæœ‰æ•ˆçš„ç”¨æˆ·ä¼šè¯ï¼‰ï¼Œå°†ä¼šè¯æ•°æ®å­˜å…¥è¯·æ±‚\nè§£æå¤±è´¥ || ä¼šè¯è½¬æ¢å¤±è´¥ï¼Œè¿”å›æ‹’ç»å“åº”\n\n\nè§£ææˆæœå¹¶å®Œæˆä¼šè¯åˆ›å»ºä¹‹åï¼Œå°†ä¼šæŠŠreqé‡æ–°è¿˜åŸå›åˆ°ServiceRequestä»è€Œèƒ½å¤ŸæŒ‰ç…§Actix-webçš„è¦æ±‚ç»§ç»­ä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡{æ€»ç»“ï¼Œå…³äºåœ¨Zinoä¸­å¦‚ä½•å¤„ç†requestï¼Œæ˜¯å…¼å®¹actix-webçš„ï¼Œåœ¨å…·ä½“çš„å“åº”å¤„ç†ä¸­ï¼Œä½¿ç”¨zinoä¸­å·²ç»é¢„å…ˆå‡†å¤‡å¥½çš„æ ‡å‡†åŒ–æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æºä»£ç ä¸­çš„let mut req = Request::from(req);å’Œlet req = ServiceRequest::from(req);é€šè¿‡è½¬æ¢reqçš„ç±»å‹æ¥æ¥å…¥zinoçš„æ ‡å‡†åŒ–å¤„ç†ï¼Œç„¶åè¿˜åŸåˆ°actix-webçš„æ ‡å‡†ç±»å‹ä¸­æ¥ä¿æŒå…¼å®¹è¯·æ±‚ä¼ é€’}\nBox::pin(async move &#123; let res = fut.await?; Ok(res) &#125;)é€šè¿‡ Box::pin å°† fut.await åŒ…è£…æˆä¸€ä¸ªå›ºå®šçš„å¼‚æ­¥ä»»åŠ¡ã€‚åœ¨è¿™é‡Œï¼Œç­‰å¾…å®é™…æœåŠ¡çš„å“åº”å¹¶è¿”å›ã€‚å¦‚æœæœåŠ¡å“åº”æˆåŠŸï¼Œåˆ™è¿”å›ç»“æœï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯\n\nmodelå¯¹äºmodeléƒ¨åˆ†ï¼Œæ˜¯é¡¹ç›®å®ç°çš„æ ¸å¿ƒã€‚è¿™é‡Œå°†ä¼šå‚ç…§zino crateçš„æ–‡æ¡£è¿›è¡Œè¯¦ç»†é˜…è¯»ã€‚\n123use serde::&#123;Deserialize, Serialize&#125;; // åºåˆ—åŒ– ååºåˆ—åŒ–use zino::prelude::*; // zinoæ‰“åŒ…çš„é¢„å¯¼å…¥æ¨¡å—ï¼Œé‡Œé¢åŒ…å«äº†zinoçš„ä¸»è¦å¸¸ç”¨æ¨¡å—use zino_derive::&#123;DecodeRow, Model, ModelAccessor, ModelHooks, Schema&#125;;\n\nzino::prelude1234567891011121314151617181920212223242526272829pub use zino_core::&#123;    // åº”ç”¨ç›¸å…³    application::&#123;Application, Plugin&#125;,    state::State,        // é”™è¯¯å¤„ç†    error::Error,    bail, warn,        // æ—¶é—´æ—¥æœŸ    datetime::&#123;Date, DateTime, Time&#125;,        // JSONæ‰©å±•    extension::&#123;JsonObjectExt, JsonValueExt, TomlTableExt&#125;,    json,        // æ¨¡å‹ç›¸å…³    model::&#123;Model, ModelHooks, Mutation, Query, QueryContext&#125;,        // ä»»åŠ¡è°ƒåº¦    schedule::&#123;        AsyncCronJob, AsyncJob, AsyncJobScheduler,        CronJob, Job, JobContext, JobScheduler    &#125;,        // åŸºç¡€ç±»å‹    BoxFuture, Decimal, LazyLock, Map, Record, Uuid,    validation::Validation,&#125;;\n\nä»¥åŠä¸€äº›featureçš„å¯é€‰é¡¹ï¼ŒæŒ‰éœ€å–ç”¨ã€‚\nzino_deriveå¯¼å…¥è¿‡ç¨‹å®ï¼Œé¿å…æ‰‹åŠ¨å®ç°ï¼Œzinoä¸­çš„å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½èƒ½é€šè¿‡deriveè¿‡ç¨‹å®è¿›è¡Œå®ç°ï¼Œè¯¦ç»†å‚ç…§crateçš„ä»£ç ã€‚\n12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#![doc = include_str!(&quot;../README.md&quot;)]#![doc(html_favicon_url = &quot;https://zino.cc/assets/zino-logo.png&quot;)]#![doc(html_logo_url = &quot;https://zino.cc/assets/zino-logo.svg&quot;)]#![forbid(unsafe_code)]use proc_macro::TokenStream;use syn::&#123;parse_macro_input, DeriveInput&#125;;mod decode_row;mod entity;mod model;mod model_accessor;mod model_hooks;mod parser;mod schema;#[doc = include_str!(&quot;../docs/entity.md&quot;)]#[proc_macro_derive(Entity, attributes(schema))]pub fn derive_entity(item: TokenStream) -&gt; TokenStream &#123;    let input = parse_macro_input!(item as DeriveInput);    let output = entity::parse_token_stream(input);    TokenStream::from(output)&#125;#[doc = include_str!(&quot;../docs/schema.md&quot;)]#[proc_macro_derive(Schema, attributes(schema))]pub fn derive_schema(item: TokenStream) -&gt; TokenStream &#123;    let input = parse_macro_input!(item as DeriveInput);    let output = schema::parse_token_stream(input);    TokenStream::from(output)&#125;#[doc = include_str!(&quot;../docs/model_accessor.md&quot;)]#[proc_macro_derive(ModelAccessor, attributes(schema))]pub fn derive_model_accessor(item: TokenStream) -&gt; TokenStream &#123;    let input = parse_macro_input!(item as DeriveInput);    let output = model_accessor::parse_token_stream(input);    TokenStream::from(output)&#125;#[doc = include_str!(&quot;../docs/decode_row.md&quot;)]#[proc_macro_derive(DecodeRow, attributes(schema))]pub fn derive_decode_row(item: TokenStream) -&gt; TokenStream &#123;    let input = parse_macro_input!(item as DeriveInput);    let output = decode_row::parse_token_stream(input);    TokenStream::from(output)&#125;#[doc = include_str!(&quot;../docs/model_hooks.md&quot;)]#[proc_macro_derive(ModelHooks, attributes(schema))]pub fn derive_model_hooks(item: TokenStream) -&gt; TokenStream &#123;    let input = parse_macro_input!(item as DeriveInput);    let output = model_hooks::parse_token_stream(input);    TokenStream::from(output)&#125;#[doc = include_str!(&quot;../docs/model.md&quot;)]#[proc_macro_derive(Model, attributes(schema))]pub fn derive_model(item: TokenStream) -&gt; TokenStream &#123;    let input = parse_macro_input!(item as DeriveInput);    let output = model::parse_token_stream(input);    TokenStream::from(output)&#125;\n\n\npub struct Tagä»£ç ä¸­ä¸ºTagå®ç°äº† Debug,Clone,Default,Serialize,eserialize,DecodeRow,Schema,ModelAccessor,ModelHooks,Model,å®ã€‚è¿˜æœ‰ä¸€ä¸ªéœ€è¦é‡ç‚¹äº†è§£çš„#[schema(auto_rename)]\n\nauto_rename:\n\nå‘½åè§„èŒƒè½¬æ¢ï¼š\nç»“æ„ä½“åç§° -&gt; è¡¨åï¼ˆé©¼å³°è½¬è›‡å½¢ï¼‰\nå­—æ®µå -&gt; åˆ—åï¼ˆé©¼å³°è½¬è›‡å½¢ï¼‰\n\n\nç‰¹æ®Šå¤„ç†ï¼š\nä¿ç•™å­—æ®µï¼ˆå¦‚ created_at, updated_at ç­‰ï¼‰\nä¸»é”®å­—æ®µï¼ˆé»˜è®¤ä¸º idï¼‰\nå¼•ç”¨å­—æ®µï¼ˆå¦‚ parent_idï¼‰\nç”Ÿæˆé™æ€å…ƒæ•°æ®\n\n\n\n\nDecodeRow\n\nå°†å®šä¹‰çš„å­—æ®µè½¬æ¢ä¸ºæ•°æ®åº“çš„åˆ—å\n\n\nModelHooks\n\nzinoé¢„å…ˆç»§æ‰¿äº†æœ‰å…³ORMç­‰çš„æ“ä½œï¼Œç›¸å…³å¯ä»¥å‚è€ƒæºä»£ç ã€‚\n\nåœ¨æ ‡å‡†å®ç°ä¸­ï¼Œä¿ç•™æœ‰ç©ºæ¥å£ï¼Œè¿™äº›æ¥å£ä½ å¯ä»¥é€šè¿‡æ‰‹åŠ¨é‡å†™æ¥å°†é€»è¾‘æ’å…¥åˆ°zinoæä¾›çš„æ ‡å‡†å®ç°ä¸­ï¼Œä»è€Œè¾¾åˆ°ä¸ªæ€§åŒ–ä¸šåŠ¡é€»è¾‘éœ€æ±‚ã€‚æ¯”å¦‚ï¼š\n123456fn x() -&gt; () &#123;    .....    hook1();    ....    hook2();&#125;\n\né€šè¿‡é‡å†™hook1å’Œhook2ï¼Œä»è€Œå°†ä¸ªæ€§åŒ–ä¸šåŠ¡é€»è¾‘æ’å…¥åˆ°æ ‡å‡†æ“ä½œçš„æŒ‡å®šä½ç½®ï¼Œä¾‹å¦‚å†™å…¥æ•°æ®åº“å‰åã€‚\n\n\n\nschema\n\næ•°æ®åº“æ˜ å°„ï¼š\nå®šä¹‰è¡¨ç»“æ„\nè®¾ç½®å­—æ®µç±»å‹\nåˆ›å»ºç´¢å¼•\nå»ºç«‹å¤–é”®å…³ç³»\n\n\néªŒè¯è§„åˆ™ï¼š\néç©ºæ£€æŸ¥\né»˜è®¤å€¼å¤„ç†\nå­—æ®µè®¿é—®æ§åˆ¶\n\n\næ–‡æ¡£ç”Ÿæˆï¼š\nAPIæ–‡æ¡£\næ•°æ®åº“æ–‡æ¡£\nå­—æ®µè¯´æ˜\n\n\nä»£ç ç”Ÿæˆï¼š\nORMæ–¹æ³•\nCRUDæ“ä½œ\næ¨¡å‹å…³è”\n\n\né€šè¿‡æ ‡å‡†åŒ–è¯­æ³•ï¼Œæ¥ç”¨æœ€å°‘çš„ä»£ç é‡å®ç°æ¨¡å‹å®šä¹‰ã€‚\n\n\n\nscheduleè°ƒåº¦å™¨è®¾è®¡\njob.rs\nä¸»è¦å®šä¹‰äº†å…·ä½“ä»»åŠ¡å®ç°ï¼Œä¾‹å¦‚å®šæ—¶ä»»åŠ¡ç­‰ã€‚\nåœ¨ä»»åŠ¡ä¸­å¯ä»¥è®¾è®¡å¼‚æ­¥ä»»åŠ¡ã€‚\nå®ç°åŒæ­¥ä»»åŠ¡çš„å¼‚æ­¥ä»»åŠ¡çš„è®¾è®¡\n\nmod.rsé…ç½®è°ƒåº¦å™¨\nåˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥ã€‚ç®€å•ä»£ç ï¼Œç»„ç»‡æ–¹å¼å°±æ˜¯åˆ›å»ºåœ¨jobä¸­å®šä¹‰çš„ä»»åŠ¡ï¼Œæ·»åŠ è®¾ç½®ç„¶åæ·»åŠ åˆ°schedulerä¸­ä½œä¸ºè¿”å›å€¼ã€‚\ncontrollerstats12345678910111213141516171819202122pub async fn index(req: Request) -&gt; Result &#123;    // 1. åˆ›å»ºå“åº”å¯¹è±¡ï¼Œå¹¶å…³è”è¯·æ±‚ä¸Šä¸‹æ–‡    let res = Response::default().context(&amp;req);    // 2. æ„å»ºç»Ÿè®¡æ•°æ®    let stats = json!(&#123;        &quot;method&quot;: &quot;GET&quot;,        &quot;path&quot;: &quot;/stats&quot;,        // è·å–é›†ç¾¤çŠ¶æ€æ•°æ®        &quot;app_state_data&quot;: Cluster::state_data(),    &#125;);    // 3. å‡†å¤‡æ¨¡æ¿æ•°æ®    let data = json!(&#123;        &quot;title&quot;: &quot;Stats&quot;,        // æ ¼å¼åŒ–ç»Ÿè®¡æ•°æ®        &quot;output&quot;: stats.to_string_pretty(),    &#125;);    // 4. æ¸²æŸ“æ¨¡æ¿å¹¶è¿”å›å“åº”    Ok(res.render(&quot;output.html&quot;, data).into())&#125;\nå…³é”®ç‚¹è§£æï¼š\n\nè¯·æ±‚å¤„ç†ï¼š\n\n1pub async fn index(req: Request) -&gt; Result\n\n\nå¼‚æ­¥å¤„ç†å‡½æ•°\n\næ¥æ”¶ Request ç±»å‹å‚æ•°\nè¿”å› Result ç±»å‹\n\n\nå“åº”æ„å»ºï¼š\n\n\n1let res = Response::default().context(&amp;req);\n\n\nåˆ›å»ºé»˜è®¤å“åº”\n\nå…³è”è¯·æ±‚ä¸Šä¸‹æ–‡\n\n\nçŠ¶æ€æ•°æ®ï¼š\n\n\n12345let stats = json!(&#123;    &quot;method&quot;: &quot;GET&quot;,    &quot;path&quot;: &quot;/stats&quot;,    &quot;app_state_data&quot;: Cluster::state_data(),  // è·å–é›†ç¾¤çŠ¶æ€&#125;);\n\n\næ¨¡æ¿æ¸²æŸ“ï¼š\n\n1Ok(res.render(&quot;output.html&quot;, data).into())\n\n\nä½¿ç”¨ output.html æ¨¡æ¿\n\nä¼ å…¥ JSON æ•°æ®\nè½¬æ¢ä¸ºå“åº”ç±»å‹\n\n\nè¿™ä¸ªæ§åˆ¶å™¨çš„ä¸»è¦åŠŸèƒ½ï¼š\n\næä¾›åº”ç”¨çŠ¶æ€ç›‘æ§\nç¤ºé›†ç¾¤çŠ¶æ€ä¿¡æ¯\né€šè¿‡æ¨¡æ¿æ¸²æŸ“æ•°æ®\nè¿”å› HTML å“åº”\n\n\nä½¿ç”¨åœºæ™¯ï¼š\n\nç³»ç»Ÿç›‘æ§\nè°ƒè¯•ä¿¡æ¯æŸ¥çœ‹\nçŠ¶æ€æ•°æ®å±•ç¤º\né›†ç¾¤ä¿¡æ¯ç›‘æ§\n\n\nè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ MVC æ¶æ„ä¸­çš„æ§åˆ¶å™¨å®ç°ï¼Œè´Ÿè´£ï¼š\n\nå¤„ç†è¯·æ±‚\n\nè·å–æ•°æ®\n\nå‡†å¤‡è§†å›¾\n\nè¿”å›å“åº”\n\n\n\n\nuser.rsåŒ…å«äº†åˆ›å»ºç”¨æˆ·å’ŒæŸ¥çœ‹ç”¨æˆ·ä¸¤ä¸ªéƒ¨åˆ†ã€‚\n\nnew()éƒ¨åˆ†çš„æ ‡å‡†æµç¨‹ï¼š \nåˆ›å»ºç”¨æˆ·å¹¶éªŒè¯\næ£€æŸ¥çº¦æŸæ¡ä»¶\nä¿å­˜ç”¨æˆ·\nå‡†å¤‡å“åº”æ•°æ®\nè®¾ç½®å“åº”\n\n\nview():\nè·å–ç”¨æˆ·id\næŸ¥è¯¢ç”¨æˆ·\næƒé™æ£€æŸ¥\næ„å»ºå“åº”\n\n\n\nfile.rs\nupload\n12345678910111213141516171819202122232425262728293031323334353637383940pub async fn upload(mut req: Request) -&gt; Result &#123;    // 1. è§£æè¡¨å•æ•°æ®    let (mut body, files) = req.parse_form_data::&lt;Map&gt;().await?;    // 2. è·å–ä¸Šä¼ ç›®å½•    let dir = Cluster::shared_dir(&quot;uploads&quot;);    let expires = DateTime::now() + Duration::from_secs(600); // 10åˆ†é’Ÿè¿‡æœŸ    let mut encryption_duration = Duration::ZERO;    let mut uploads = Vec::new();    // 3. å¤„ç†æ¯ä¸ªæ–‡ä»¶    for mut file in files &#123;        // 3.1 ç”Ÿæˆè®¿é—®å‡­è¯        let mut query = Map::new();        let access_key_id = AccessKeyId::new();        let secret_key = SecretAccessKey::new(&amp;access_key_id);        let security_token = SecurityToken::try_new(            access_key_id,             expires,             &amp;secret_key        ).extract(&amp;req)?;        // 3.2 åŠ å¯†æ–‡ä»¶        let encryption_start_time = Instant::now();        file.encrypt_with(secret_key.as_ref()).extract(&amp;req)?;        encryption_duration += encryption_start_time.elapsed();        // 3.3 ä¿å­˜æ–‡ä»¶        if let Some(file_name) = file.file_name() &#123;            file.write(dir.join(file_name)).extract(&amp;req)?;                        // 3.4 å‡†å¤‡æ–‡ä»¶ä¿¡æ¯            let mut map = Map::new();            map.upsert(&quot;field_name&quot;, file.field_name());            map.upsert(&quot;file_name&quot;, file_name);            map.upsert(&quot;content_type&quot;, file.content_type().map(|m| m.as_ref()));            map.upsert(&quot;url&quot;, format!(&quot;/file/decrypt?&#123;&#125;&quot;, query.to_query_string()));            uploads.push(map);        &#125;    &#125;\n\ndecrypt\n\nrustpub async fn decrypt(req: Request) -&gt; Result &#123;\n    // 1. éªŒè¯è®¿é—®å‡­è¯\n    let query = req.parse_query::&lt;Map&gt;()?;\n    let access_key_id = req.parse_access_key_id()?;\n    let secret_key = SecretAccessKey::new(&amp;access_key_id);\n    let security_token = req.parse_security_token(secret_key.as_ref())?;\n    // ä»¤ç‰Œè¿‡æœŸæ£€æŸ¥\n    if security_token.is_expired() &#123;\n        reject!(req, forbidden, &quot;the security token has expired&quot;);\n    &#125;\n\n    // 2. è·å–æ–‡ä»¶\n    let Some(file_name) = query.get_str(&quot;file_name&quot;) else &#123;\n        reject!(req, &quot;file_name&quot;, &quot;it should be specified&quot;);\n    &#125;;\n    let file_path = Cluster::shared_dir(&quot;uploads&quot;).join(file_name);\n\n    // 3. è§£å¯†å¹¶å‘é€æ–‡ä»¶\n    let mut file = NamedFile::try_from_local(file_path).extract(&amp;req)?;\n    let decryption_start_time = Instant::now();\n    file.decrypt_with(secret_key).extract(&amp;req)?;\n&lt;!--codeï¿¼15--&gt;\nrefresh\n123456789101112pub async fn refresh(req: Request) -&gt; Result &#123;    // 1. è§£æå½“å‰JWTä»¤ç‰Œ    let claims = req.parse_jwt_claims(JwtClaims::shared_key())?;        // 2. åˆ·æ–°ä»¤ç‰Œ    let data = User::refresh_token(&amp;claims).await.extract(&amp;req)?;        // 3. è¿”å›æ–°ä»¤ç‰Œ    let mut res = Response::default().context(&amp;req);    res.set_json_data(data);    Ok(res.into())&#125;\n\nrefresh åº”è¯¥æ˜¯è®¾è®¡åœ¨åå°è‡ªåŠ¨åˆ·æ–°çš„ï¼Ÿexampleä¸­ç–‘ä¼¼å¹¶æ²¡æœ‰å®ç°è°ƒç”¨çš„åŠŸèƒ½ï¼Œ{è¿™ä¹Ÿæ˜¯ä¹‹å‰æ²¡æœ‰å°è¯•è¿‡çš„åšæ³•å‘¢}\n\n\n\n\n\n\n\n\n\n\nTIP\n\n\n\nlogout\n\nrustpub async fn logout(req: Request) -&gt; Result &#123;\n    // 1. è·å–ç”¨æˆ·ä¼šè¯\n    let user_session = req\n        .get_data::&lt;UserSession&lt;_&gt;&gt;()\n        .ok_or_else(|| warn!(&quot;401 Unauthorized: user session is invalid&quot;))\n        .extract(&amp;req)?;\n    let user_id = user_session.user_id();\n\n    // 2. æ›´æ–°ç”¨æˆ·çŠ¶æ€\n    let mut mutation = MutationBuilder::&lt;User&gt;::new()\n        .set(Status, &quot;SignedOut&quot;)    // è®¾ç½®ä¸ºç™»å‡ºçŠ¶æ€\n        .set_now(UpdatedAt)          // æ›´æ–°æ—¶é—´\n        .inc_one(Version)            // ç‰ˆæœ¬å·+1\n        .build();\n        \n    // 3. æ‰§è¡Œæ›´æ–°\n    let user: User = User::update_by_id(user_id, &amp;mut mutation)\n        .await\n        .extract(&amp;req)?;\n\n\né‡ç‚¹å…³æ³¨åˆ°Jwtçš„è®¤è¯ï¼ŒåŒ…æ‹¬ä»¤ç‰Œç”Ÿæˆï¼Œä»¤ç‰Œè§£æä»¥åŠåˆ·æ–°ä»¤ç‰Œ\n\nä¼šè¯ç®¡ç†ï¼š è·å– &amp;&amp; éªŒè¯\n\nå…³äºç”¨æˆ·çŠ¶æ€çš„è®¾ç½®ï¼Œ.set(Status, &quot;&quot;),å¦‚Activeï¼ŒSignedOut\n\nç‰ˆæœ¬æ§åˆ¶çš„éƒ¨åˆ†ä¸æ˜¯å¾ˆæ‡‚æ˜¯åœ¨åšä»€ä¹ˆ\n\n\n\n\n\n\n\n\n\nTIP\n\n\n","slug":"zino-start","date":"2024-09-03T14:00:00.000Z","categories_index":"Zino,åç«¯,Rust","tags_index":"rust,zino","author_index":"RaphaelNY"},{"id":"52d0fe63d1c1ad7c08273efe980dc2ed","title":"Solana escrowåˆçº¦ ç¼–ç¨‹å­¦ä¹ ","content":"å‰è¨€è‹¦äºsolanaå…¥é—¨é—¨æ§›ï¼Œå¯¹äºåšä¸»è¿™æ ·çš„åŒºå—é“¾å°ç™½è€Œè¨€ï¼Œç¡®å®æœ‰äº›å¹¸è‹¦ğŸ˜­ã€‚æ‰€ä»¥ï¼Œç»è¿‡æŸ¥è¯¢ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡ç®€å•çš„å…¥é—¨æ•™ç¨‹ğŸ“–ã€‚\nåŒæ—¶ï¼Œè¿™æ˜¯æœ¬æ¬¡å­¦ä¹ çš„æºæ–‡ç« \næˆ‘çš„ç›¸å…³å­¦ä¹ èµ„æ–™ä¼šæ”¾åœ¨æˆ‘çš„githubä»“åº“ä¸­\n\n\n\n\n\n\nTIP\nå¦‚æœä½ å¯¹æ–¼åŒºå—é“¾æ²¡æœ‰ä»»ä½•çŸ¥è¯†ï¼Œæˆ–è€…è¯´ä½ å®Œå…¨æ²¡äº†è§£solanaï¼Œä½ ä¹Ÿè®¸å¯ä»¥å…ˆè€ƒè™‘ä»¥ä¸‹videoå’Œæ–‡æ¡£\n\nğŸ“ºã€Solanaå¼€å‘è¯¾ã€‘å­¦ä¹ ä½¿ç”¨Rust+JavaScriptè¿›è¡ŒSolanaåŒºå—é“¾å¼€å‘ | æŒæ¡ Web3ã€DAppã€NFTã€DeFiç­‰äº§å“å¼€å‘ | ä¸­æ–‡å­—å¹•\nğŸ“–ä»‹ç» | Solanaä¸­æ–‡å¤§å…¨ (solana-cn.com)\nğŸ“–Home | Solana Validator (solanalabs.com)\nğŸ“–Solana Documentation | Solana\nSolana æ™ºèƒ½åˆçº¦æŒ‡å— | ç™»é“¾ç¤¾åŒº | åŒºå—é“¾æŠ€æœ¯ç¤¾åŒº (learnblockchain.cn)\n\nè¿™è¾¹å»ºè®®ä½¿ç”¨â‘¡çš„æ–‡æ¡£ï¼Œæœ‰ä¸€è¯´ä¸€â‘£çš„zhç¿»è¯‘çœŸçš„æ˜¯ç¿»ä¸€åŠğŸ˜¤æˆ‘è¿˜æ˜¯å€¾å‘äºçœ‹äººè¯ç¿»è¯‘å‡ºæ¥çš„\n\n\nå‰æœŸå‡†å¤‡å®‰è£…Solana-cilã€‚æˆ‘è¿˜æ˜¯æ¨èä½¿ç”¨âš™ï¸Cargoæ¥è¿›è¡ŒåŒ…ç®¡ç†ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å…¶ä»–é€”å¾„è¿›è¡Œå®‰è£…ğŸ¤—è£…ä¸äº†å»ºè®®æ¢ç½‘\n1cargo install solana-cli --locked --version 1.9.1\n\n\næ³¨æ„ä½ çš„âš™ï¸rustæœ€å¥½ä½¿ç”¨æœ€æ–°çš„ç‰ˆæœ¬ï¼Œsolana-cilçš„ç‰ˆæœ¬ä¹Ÿå»ºè®®ä½¿ç”¨æœ€æ–°çš„ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒcrate.io^1ã€‚\n\né¡¹ç›®åˆ›å»º1cargo new escrow --lib\n\n\n\n\n\n\n\nTIP\næ³¨æ„ï¼Œä¸‹è¿°æ–‡ä»¶é™¤äº†.tomlæ–‡ä»¶ï¼Œå…¶ä½™éƒ½åœ¨.&#x2F;src&#x2F;ç›®å½•ä¸‹\n\n\n123Xargo.toml // æ–‡ä»¶å[target.bpfel-unknown.dependencies.std]features = []\n\n1234567891011121314151617Cargo.toml[package]name = &quot;escrow&quot;version = &quot;0.1.0&quot;edition = &quot;2021&quot;[features]no-entrypoint = [][dependencies]arrayref = &quot;0.3.6&quot;solana-program = &quot;2.0.8&quot;thiserror = &quot;1.0&quot;spl-token = &#123;version = &quot;6.0.0&quot;, features = [&quot;no-entrypoint&quot;]&#125;[lib]crate-type = [&quot;cdylib&quot;, &quot;lib&quot;]\n\n\nç¬¬ä¸€ä¸ªé¡¹ç›®è¦å­¦ä¹ çš„æ˜¯ä¸€ä¸ªæ‰˜ç®¡åˆçº¦ï¼Œä¸»è¦æ˜¯è§£å†³äº¤æ˜“ä¸­çš„å»ä¿¡ä»»é—®é¢˜ã€‚\nåœ¨åŒºå—é“¾ä¸­ï¼Œæ™ºèƒ½åˆçº¦åŒæ–¹å‡å¯è§ï¼Œå±äºå¤©ç„¶çš„å¯ä¿¡ç¬¬ä¸‰æ–¹ğŸ‘®â€â™‚ï¸ã€‚\nä¸è¿‡ï¼Œç†è®ºæ˜¯ç†è®ºğŸ¤—solanaå¹¶ä¸å®Œå…¨é€‚ç”¨ï¼Œå› ä¸ºsolanaåˆçº¦æ˜¯å¯ä»¥å‡çº§çš„ï¼Œæœ‰å¯èƒ½ä½ çœ‹åˆ°çš„ä¸ä¸€å®šæ˜¯è¢«éƒ¨ç½²çš„ï¼Œä¸è¿‡è¿™éƒ½ä¸é‡è¦ğŸ¤”æˆ‘ä»¬æš‚æ—¶æ¶‰åŠä¸åˆ°é‚£ä¸ªéƒ¨åˆ†\n\n\n\n\n\n\n\n\n\n\nåŸºäºæˆ‘ä¸ªäººçš„ç†è§£ï¼Œæ™ºèƒ½åˆçº¦å°±æ˜¯æ‰¿æ‹…ä¸€ç¬”äº¤æ˜“çš„ç¬¬ä¸‰æ–¹æ‹…ä¿ï¼Œç”¨æ¥ä¿è¯ä¸€åœºäº¤æ˜“ä¸­ä¸ä¼šäº§ç”Ÿäº¤æ˜“åŒæ–¹ç”±äºæ— æ³•ä¿¡ä»»å¯¹æ–¹æˆ–è€…ç¼ºå°‘å¯ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹å¯¼è‡´äº¤æ˜“æ— æ³•æ­£å¸¸è¿›è¡Œã€‚æ‰“ä¸ªä¸æ°å½“çš„æ¯”å–»ï¼Œæœ‰ç‚¹åƒæ˜¯é€šè¿‡æ”¯ä»˜å® || å¾®ä¿¡è¿›è¡Œçš„äº¤æ˜“ï¼Œå¤§å®¶éƒ½èƒ½å¤Ÿå®Œå…¨çš„ä¿¡ä»»ï¼Œå°±æ˜¯å› ä¸ºä»–ä»¬åœ¨æˆ‘ä»¬çš„äº¤æ˜“ä¸­æä¾›äº†èµ„é‡‘äº¤æµçš„ä¿è¯ã€‚\n\n\n\n\n\n\nTIP\nåœ¨SolanaåŒºå—é“¾ä¸­ï¼Œæ™ºèƒ½åˆçº¦æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸èƒ½ä¿å­˜ä»»ä½•æ•°æ®ã€‚æ‰€æœ‰éœ€è¦ä¿å­˜çš„æ•°æ®å‡ä¿å­˜åœ¨è´¦å·çš„dataå­—æ®µä¸­ã€‚\nå…³äºSpl-tokenåŠè´¦å·ç›¸å…³çš„ä¸€äº›åŸºç¡€çŸ¥è¯†è¯·è¯»è€…è‡ªè¡Œé˜…è¯»ç›¸åº”æ–‡ç« æˆ–è€…æºæ•™å­¦æ–‡ç« ã€‚\n\n\n\nåœ¨srcç›®å½•ä¸‹åˆ›å»ºerror.rs ,instruction.rs, processor.rs,entrypoint.rs,state.rsç¨åæˆ‘ä»¬å°†åœ¨è¿™äº›æ–‡ä»¶ä¸­æ’°å†™ä»£ç \n\nç¼–å†™åŸºæœ¬æ¡†æ¶\n\n\n\n\n\n\n\n\nä¸‹é¢ä¼šå…ˆæ”¾æºç ï¼Œå†æ”¾æˆ‘çš„ä¸ªäººç†è§£ï¼Œåªæƒ³çœ‹ä»£ç çš„å¯ä»¥é€šè¿‡å¤§çº²è¿›è¡Œè·³è½¬ã€‚\nError.rs12345678910111213141516use thiserror::Error;use solana_program::program_error::ProgramError;#[derive(Error,Debug,Copy,Clone)]pub enum EscrowError &#123;    // Invalid instruction    #[error(&quot;Invalid Instruction&quot;)]    InvalidInstruction,&#125;impl From&lt;EscrowError&gt; for ProgramError &#123;    fn from(e: EscrowError) -&gt; Self &#123;        ProgramError::Custom(e as u32)    &#125;&#125;\n\n\n\n\n\n\n\n\n\n\nè¿™é‡Œä½¿ç”¨thiserrorçš„åŸå› åŸæ–‡ä¸­å†™çš„å¾ˆæ˜ç¡®ï¼Œçœå»æˆ‘ä»¬æ‰‹åŠ¨å®ç°ç›¸å…³Traitã€‚\n\nsolanaç¨‹åºçš„è¿”å›å€¼é€šå¸¸ä¸ºProgramError,æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œä¸ºProgramErroræšä¸¾ä¸­çš„æ‰€æœ‰ç±»å‹å®ç°FromTraitè½¬æ¢ä¸ºEscrowError\n\ninstruction.rs12345678910111213141516171819202122232425262728293031323334353637383940414243use std::convert::TryInto;use crate::error::EscrowError::InvalidInstruction;use solana_program::program_error::ProgramError;pub enum EscrowInstruction &#123;    /// å› ä¸ºè¦åœ¨åˆå§‹åŒ–é‡Œè½¬ç§»ä¸´æ—¶ä»£å¸è´¦å·æ‰€æœ‰æƒï¼Œæ‰€ä»¥éœ€è¦åŸownerç­¾åï¼Œå¹¶ä¸”åŸownerä¹Ÿæ˜¯åˆå§‹åŒ–è€…    /// 0. `[signer]` The account of the person initializing the escrow    /// 1. `[writable]` Temporary token account that should be created prior to this instruction and owned by the initializer    /// 2. `[]` The initializer&#x27;s token account for the token they will receive should the trade go through    /// 3. `[writable]` The escrow account, it will hold all necessary info about the trade.    /// 4. `[]` The rent sysvar    /// 5. `[]` The token program    InitEscrow &#123;        /// The amount party A expects to receive of token Y        amount: u64    &#125;&#125;impl EscrowInstruction &#123;    pub fn unpack(input: &amp;[u8]) -&gt; Result&lt;Self, ProgramError&gt; &#123;        let (tag, rest) = input.split_first().ok_or(InvalidInstruction)?;                Ok(match tag &#123;            0 =&gt; Self::InitEscrow &#123;                amount: Self::unpack_amount(rest)?,            &#125;,            //æ³¨æ„è¿™é‡Œçš„ç”¨æ³•ï¼ŒInvalidInstructionè½¬åŒ–ä¸ºProgramErroræ—¶ï¼Œä½¿ç”¨äº†into          \t//å› ä¸ºæˆ‘ä»¬åœ¨error.rsä¸­å·²ç»å®ç°äº†é‚£ä¸ªfromï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®ç°into            _ =&gt; return Err(InvalidInstruction.into()),        &#125;)    &#125;    //è¿™é‡Œå­¦ä¹ Input è½¬åŒ–ä¸ºu64    fn unpack_amount(input: &amp;[u8]) -&gt; Result&lt;u64, ProgramError&gt; &#123;        let amount = input            .get(..8)            .and_then(|slice| slice.try_into().ok())            .map(u64::from_le_bytes)            .ok_or(InvalidInstruction)?;        Ok(amount)    &#125;&#125;\n\n\nåœ¨è¿™æ®µä»£ç é‡Œå‡†å¤‡ä¸€ä»½åˆå§‹åŒ–æŒ‡ä»¤ï¼Œç¼–å†™unpackå‡½æ•°ç”¨æ¥å°†è¾“å…¥æ•°æ®è§£æä¸ºä¸€ä¸ªæŒ‡ä»¤\n\nåç»­æ·»åŠ æ–°çš„æŒ‡ä»¤ç»§ç»­åœ¨unpackå‡½æ•°ä¸­æ·»åŠ å†…å®¹å³å¯ã€‚æ³¨æ„å‡½æ•°è¿”å›ç±»å‹Result&lt;Self, ProgramError&gt;\n\nç”±äºinputæ˜¯&amp;[u8]ç±»å‹ï¼Œæˆ‘ä»¬åœ¨åˆå§‹åŒ–ä»£å¸æ‰€æœ‰æƒä¸­ä½¿ç”¨äº†amount: u64,æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªç±»å‹è½¬æ¢ï¼Œä»inputä¸­åˆ‡å–ä»£è¡¨amountçš„éƒ¨åˆ†ã€‚\n\næ•´ä¸ªè¿‡ç¨‹çš„ç›®çš„æ˜¯å°è¯•ä» input çš„å‰ 8 ä¸ªå­—èŠ‚ä¸­è¯»å–ä¸€ä¸ª u64 å€¼ï¼š\nè·å–å‰ 8 ä¸ªå­—èŠ‚ï¼šé€šè¿‡ input.get(..8) å°è¯•è·å–åˆ‡ç‰‡çš„å‰ 8 ä¸ªå­—èŠ‚ã€‚\nè½¬æ¢åˆ‡ç‰‡åˆ°æ•°ç»„ï¼šä½¿ç”¨ .and_then å’Œ try_into() å°†å­—èŠ‚åˆ‡ç‰‡è½¬æ¢ä¸ºä¸€ä¸ªå›ºå®šå¤§å°çš„å­—èŠ‚æ•°ç»„ [u8; 8]ã€‚\n**è½¬æ¢å­—èŠ‚æ•°ç»„åˆ° u64**ï¼šä½¿ç”¨ map(u64::from_le_bytes) å°† [u8; 8] è½¬æ¢ä¸º u64ã€‚\né”™è¯¯å¤„ç†ï¼šå¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œè¿”å› InvalidInstruction é”™è¯¯ã€‚\n\n\n\n\n\nprocessor.rs12345678910111213141516171819202122232425262728293031323334353637use solana_program::&#123;    account_info::&#123;next_account_info,AccountInfo&#125;,    entrypoint::ProgramResult,    program_error::ProgramError,    msg,    pubkey::Pubkey,&#125;;use crate::instruction::EscrowInstruction;pub struct Processor;impl Processor &#123;    pub fn process(program_id: &amp;Pubkey, accounts: &amp;[AccountInfo], instruction_data: &amp;[u8]) -&gt; ProgramResult &#123;        let instruction = EscrowInstruction::unpack(instruction_data)?;                match instruction &#123;            EscrowInstruction::InitEscrow &#123;amount&#125; =&gt; &#123;                msg!(&quot;Instruction: InitEscrow&quot;);                Self::process_init_escrow(accounts,amount,program_id)            &#125;        &#125;    &#125;    fn process_init_escrow(        accounts: &amp;[AccountInfo],        amount: u64,        program_id: &amp;Pubkey    ) -&gt; ProgramResult &#123;        let account_info_iter = &amp;mut accounts.iter();        let initializer = next_account_info(account_info_iter)?;        if !initializer.is_signer &#123;            return Err(ProgramError::MissingRequiredSignature);        &#125;\t\t\t\t// todo        Ok(())    &#125;&#125;\n\n\n\n\n\n\n\nTIP\n\nè¿™é‡Œä¸€èˆ¬ä¸ºå›ºå®šçš„Processorç»“æ„ä½“ï¼ˆåªæ˜¯çº¦å®šï¼Œæ— å¼ºåˆ¶åŠ›ï¼‰ã€‚åœ¨è¯¥ç»“æ„ä½“ä¸Šåˆ›å»ºä¸€ä¸ªé™æ€å‡½æ•°processæ¥å¤„ç†å…¥å£è½¬å‘è¿‡æ¥çš„å‚æ•°ã€‚åœ¨è¯¥å‡½æ•°å†…éƒ¨ï¼Œé¦–å…ˆè§£ææŒ‡ä»¤ï¼Œç„¶åæ ¹æ®æŒ‡ä»¤è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚\nprocessorè¿”å›çš„æ˜¯ProgramResultã€‚\nå‡½æ•°ä½“ä¸­?æ“ä½œç¬¦çš„ä½¿ç”¨ï¼Œå‘ä¸Šçº§è°ƒç”¨ä¼ é€’é”™è¯¯ã€‚\n\n\nprocess_init_escrowå¹¶æ²¡æœ‰å®Œå…¨ç¼–å†™ğŸ¤—åç»­ä¼šè¿›è¡Œç¼–å†™\n\n\n\nentrypoint.rs12345678910111213141516171819//! Program entrypointuse crate::&#123;processor::Processor&#125;;use solana_program::&#123;    account_info::AccountInfo,     entrypoint,     entrypoint::ProgramResult,    pubkey::Pubkey,&#125;;entrypoint!(process_instruction);fn process_instruction(    program_id: &amp;Pubkey,    accounts: &amp;[AccountInfo],    instruction_data: &amp;[u8],) -&gt; ProgramResult &#123;    Processor::process(program_id, accounts, instruction_data) &#125;\n\n\nè¿™éƒ¨åˆ†åœ¨lib.rsä¸­å£°æ˜modçš„æ—¶å€™ï¼Œéœ€è¦è®¾å®šå¯å…³é—­entrypointç‰¹æ€§ï¼Œä¸ºäº†ç¨‹åºå¯ä»¥æ–¹ä¾¿çš„è¢«å…¶ä»–ç¨‹åºå¯¼å…¥ï¼ˆè¿™é‡ŒåŸæ–‡ä¸­ä¹Ÿåªæ˜¯æŒ‡å‡ºäº†æ–¹æ³•ï¼Œæ˜¯å‚è€ƒspl-tokenä¸­çš„è®¾ç½®å’Œç¼–å†™è€Œæ¥çš„ï¼‰^2\n\nè¿™æ®µä»£ç æ˜¯solanaçš„å…¥å£ç‚¹å®ç°ä»£ç ã€‚è´Ÿè´£æ¥æ”¶å’Œå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„äº¤æ˜“è¯·æ±‚ã€‚å…¥å£ç‚¹å‡½æ•°å®šä¹‰äº†å¦‚ä½•å¤„ç†æŒ‡ä»¤æ•°æ®ã€è´¦æˆ·ä¿¡æ¯ä»¥åŠç¨‹åºID\n\nentrypoint! æ˜¯ä¸€ä¸ªå®ï¼Œç”¨äºå®šä¹‰Solanaç¨‹åºçš„å…¥å£ç‚¹å‡½æ•°ã€‚åœ¨Solanaä¸­ï¼Œæ¯ä¸ªç¨‹åºå¿…é¡»æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªå…¥å£ç‚¹å‡½æ•°ã€‚\n\nentrypoint!(process_instruction) å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œprocess_instruction å‡½æ•°æ˜¯è¯¥ç¨‹åºçš„å…¥å£ç‚¹å‡½æ•°ã€‚Solanaè¿è¡Œæ—¶ä¼šåœ¨æ¯æ¬¡ç¨‹åºè¢«è°ƒç”¨æ—¶æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚\n\n\nfn process_instruction:\n\nprogram_id: &amp;Pubkey: è¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„å…¬é’¥ã€‚è¿™æ˜¯Solanaç”¨æ¥éªŒè¯è¿™ä¸ªç¨‹åºçš„æ ‡è¯†ç¬¦ã€‚\naccounts: &amp;[AccountInfo]: ä¸€ä¸ªè´¦æˆ·ä¿¡æ¯çš„åˆ‡ç‰‡ï¼ŒåŒ…å«äº†æ‰€æœ‰åœ¨è¿™ä¸ªäº¤æ˜“ä¸­æ¶‰åŠçš„è´¦æˆ·ã€‚æ¯ä¸ª AccountInfo åŒ…å«å…³äºè´¦æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚å…¬é’¥ã€ä½™é¢ã€æ‰€æœ‰è€…å’Œæ•°æ®ã€‚\ninstruction_data: &amp;[u8]: ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼ŒåŒ…å«äº†å®¢æˆ·ç«¯ä¼ é€’ç»™ç¨‹åºçš„æŒ‡ä»¤æ•°æ®ã€‚è¿™ä¸ªæ•°æ®é€šå¸¸åŒ…å«æ“ä½œç å’Œç›¸å…³çš„å‚æ•°ï¼ŒæŒ‡ç¤ºç¨‹åºåº”è¯¥æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚\n\n\n\nstate.rs12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576use solana_program::&#123;    program_pack::&#123;IsInitialized, Pack, Sealed&#125;,    program_error::ProgramError,    pubkey::Pubkey,&#125;;pub struct Escrow &#123;    pub is_initialized: bool,    pub initializer_pubkey: Pubkey,    pub temp_token_account_pubkey: Pubkey,    pub initializer_token_to_receive_account_pubkey: Pubkey,    pub expected_amount: u64,&#125;impl Sealed for Escrow &#123;&#125;impl IsInitialized for Escrow &#123;    fn is_initialized(&amp;self) -&gt; bool &#123;        self.is_initialized    &#125;&#125;use arrayref::&#123;array_mut_ref, array_ref, array_refs, mut_array_refs&#125;;impl Pack for Escrow &#123;    const LEN: usize = 105;    fn unpack_from_slice(src: &amp;[u8]) -&gt; Result&lt;Self, ProgramError&gt; &#123;        let src = array_ref![src, 0, Escrow::LEN];        let (            is_initialized,            initializer_pubkey,            temp_token_account_pubkey,            initializer_token_to_receive_account_pubkey,            expected_amount,        ) = array_refs![src, 1, 32, 32, 32, 8];        let is_initialized = match is_initialized &#123;            [0] =&gt; false,            [1] =&gt; true,            _ =&gt; return Err(ProgramError::InvalidAccountData),        &#125;;        Ok(Escrow &#123;            is_initialized,            initializer_pubkey: Pubkey::new_from_array(*initializer_pubkey),            temp_token_account_pubkey: Pubkey::new_from_array(*temp_token_account_pubkey),            initializer_token_to_receive_account_pubkey: Pubkey::new_from_array(*initializer_token_to_receive_account_pubkey),            expected_amount: u64::from_le_bytes(*expected_amount),        &#125;)    &#125;    fn pack_into_slice(&amp;self, dst: &amp;mut [u8]) &#123;        let dst = array_mut_ref![dst, 0, Escrow::LEN];        let (            is_initialized_dst,            initializer_pubkey_dst,            temp_token_account_pubkey_dst,            initializer_token_to_receive_account_pubkey_dst,            expected_amount_dst,        ) = mut_array_refs![dst, 1, 32, 32, 32, 8];        let Escrow &#123;            is_initialized,            initializer_pubkey,            temp_token_account_pubkey,            initializer_token_to_receive_account_pubkey,            expected_amount,        &#125; = self;        is_initialized_dst[0] = *is_initialized as u8;        initializer_pubkey_dst.copy_from_slice(initializer_pubkey.as_ref());        temp_token_account_pubkey_dst.copy_from_slice(temp_token_account_pubkey.as_ref());        initializer_token_to_receive_account_pubkey_dst.copy_from_slice(initializer_token_to_receive_account_pubkey.as_ref());        *expected_amount_dst = expected_amount.to_le_bytes();    &#125;&#125;\n\n\n\n\n\n\n\nTIP\n\nç›¸åŒç›®å½•åˆ›å»ºstate.rsï¼Œæ–‡ä»¶ç”¨æ¥å®šä¹‰çŠ¶æ€ä¿å­˜å¯¹è±¡å¹¶ç¼–å†™ç›¸åº”çš„ç¨‹åºå¤„ç†åºåˆ—åŒ–å’Œååºåˆ—åŒ–^3ï¼ˆä¹Ÿå°±æ˜¯å°†å­—èŠ‚æ•°ç»„å’Œæ•°æ®ç»“æ„ç›¸äº’è½¬æ¢ï¼‰\næˆ‘ä»¬çš„ç»“æ„éœ€è¦å®ç°program_pack::&#123;IsInitialized, Pack, Sealed&#125; è¿™ä¸‰ä¸ªç‰¹å‹ã€‚\nconst LEN: usize = 105;è¿™é‡Œç»“æ„çš„å¤§å°æ˜¯æ ¹æ®å„ä¸ªå­—æ®µçš„å¤§å°ç›¸åŠ å¾—åˆ°çš„ï¼Œåˆ†åˆ«ä¸º1 + 32*3 + 8 = 105ã€‚\nunpack_from_sliceä¸pack_into_sliceå¹¶ä¸æ˜¯ç›´æ¥è¢«ç¨‹åºçš„å…¶å®ƒéƒ¨åˆ†è°ƒç”¨çš„ï¼ŒPackç‰¹å‹æœ‰ä¸¤ä¸ªé»˜è®¤å‡½æ•°ï¼Œåˆ†åˆ«è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ã€‚\næ³¨æ„array_mut_ref, array_ref, array_refs, mut_array_refsè¿™å‡ ä¸ªå®çš„ç”¨æ³•ï¼Œçœ‹åå­—å°±èƒ½çŒœåˆ°ï¼Œåˆ†åˆ«ä¸ºå¾—åˆ°ä¸€ä¸ªæ•°ç»„çš„å¯å˜å¼•ç”¨ï¼Œå¾—åˆ°ä¸€ä¸ªæ•°ç»„çš„å¼•ç”¨ ï¼Œå¾—åˆ°å¤šä¸ªæ•°ç»„çš„å¼•ç”¨ï¼Œå¾—åˆ°å¤šä¸ªæ•°ç»„çš„å¯å˜å¼•ç”¨ã€‚\næ³¨æ„ç¤ºä¾‹ä¸­ä»å­—èŠ‚æ•°ç»„å¾—åˆ°å…¬é’¥çš„æ–¹æ³•copy_from_slice\nç¤ºä¾‹ä¸­ä»å­—èŠ‚æ•°ç»„å¾—åˆ°u64é‡‡ç”¨äº†to_le_byteså·¦å¯¹é½çš„æ–¹å¼ï¼ŒRustä¸­è¿˜æœ‰ç±»ä¼¼çš„å³å¯¹é½æ–¹å¼ã€‚ä½†ä¸€èˆ¬Solanaä¸­é‡‡ç”¨ç±»Cçš„å·¦å¯¹é½æ–¹å¼ã€‚\nå¸ƒå°”å€¼å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºu8ï¼Œè§is_initialized as u8ã€‚\n\n\n\n\nPackTrait\nLEN: å®šä¹‰äº†Escrowç»“æ„ä½“çš„å­—èŠ‚å¤§å°ï¼ˆ1 + 32 + 32 + 32 + 8 &#x3D; 105 å­—èŠ‚ï¼‰\n\n\nunpack_from_slice:\nä»å­—èŠ‚åˆ‡ç‰‡ä¸­é‡å»ºEscrowç»“æ„ä½“ï¼ˆä½ å¯ä»¥ç†è§£ä¸ºï¼Œé€šä¿¡æ—¶ä½¿ç”¨çš„æ˜¯å­—èŠ‚æµï¼Œå­—èŠ‚æµéœ€è¦é‡å»ºä¸ºç»“æ„ä½“æ‰èƒ½è¢«ä½¿ç”¨ï¼‰\nä½¿ç”¨array_refs!å®å°†æºå­—èŠ‚åˆ‡ç‰‡åˆ†å‰²ä¸ºäº”ä¸ªéƒ¨åˆ†ï¼Œå¹¶ä¸”æ˜ å°„åˆ°Escrowç»“æ„ä½“\næ¨¡å¼åŒ¹é…è½¬æ¢is_initialized\nå…¶ä»–å­—æ®µå‡é€šè¿‡è½¬æ¢æˆ–è€…å­—èŠ‚æ•°ç»„ä¸­æ„é€ å¾—åˆ°\n\n\npack_into_slice:\nå°†Escrowç»“æ„ä½“çš„å†…å®¹æ‰“åŒ…å›ä¸€ä¸ªå­—èŠ‚åˆ‡ç‰‡\nä½¿ç”¨mut_array_refs!å®å°†ç›®æ ‡åˆ‡ç‰‡åˆ†å‰²ä¸ºäº”ä¸ªå¯å˜éƒ¨åˆ†\nå°†ç»“æ„ä½“çš„å­—æ®µè½¬æ¢ä¸ºå­—èŠ‚å¹¶å¤åˆ¶åˆ°ç›¸åº”çš„åˆ‡ç‰‡éƒ¨åˆ†\n\n\n\nlib.rs123456#[cfg(not(feature = &quot;no-entrypoint&quot;))]mod entrypoint;pub mod error;pub mod instruction;pub mod processor;pub mod state;\n\nå®Œå–„ processor.rs123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657fn process_init_escrow(accounts: &amp;[AccountInfo], amount: u64, program_id: &amp;Pubkey) -&gt; ProgramResult &#123;    let account_info_iter = &amp;mut accounts.iter();    let initializer = next_account_info(account_info_iter)?;    if !initializer.is_signer &#123;        return Err(ProgramError::MissingRequiredSignature);    &#125;    let temp_token_account = next_account_info(account_info_iter)?;    let token_to_receive_account = next_account_info(account_info_iter)?;    if *token_to_receive_account.owner != spl_token::id() &#123;        return Err(ProgramError::IncorrectProgramId);    &#125;    let escrow_account = next_account_info(account_info_iter)?;    let rent = &amp;Rent::from_account_info(next_account_info(account_info_iter)?)?;    if !rent.is_exempt(escrow_account.lamports(), escrow_account.data_len()) &#123;        return Err(EscrowError::NotRentExempt.into());    &#125;    let mut escrow_info = Escrow::unpack_unchecked(&amp;escrow_account.data.borrow())?;    if escrow_info.is_initialized() &#123;        return Err(ProgramError::AccountAlreadyInitialized);    &#125;    escrow_info.is_initialized = true;    escrow_info.initializer_pubkey = *initializer.key;    escrow_info.temp_token_account_pubkey = *temp_token_account.key;    escrow_info.initializer_token_to_receive_account_pubkey = *token_to_receive_account.key;    escrow_info.expected_amount = amount;    Escrow::pack(escrow_info, &amp;mut escrow_account.try_borrow_mut_data()?)?;    let (pda, _bump_seed) = Pubkey::find_program_address(&amp;[b&quot;escrow&quot;], program_id);    let token_program = next_account_info(account_info_iter)?;    let owner_change_ix = spl_token::instruction::set_authority(        token_program.key,        temp_token_account.key,        Some(&amp;pda),        spl_token::instruction::AuthorityType::AccountOwner,        initializer.key,        &amp;[]    )?;    msg!(&quot;Calling the token program to transfer token account ownership...&quot;);    invoke(        &amp;owner_change_ix,        &amp;[            temp_token_account.clone(),            initializer.clone(),            token_program.clone()        ]    )?;    Ok(())&#125;\n\n\nä¿®æ”¹use crate::instruction::EscrowInstruction;ä¸ºuse crate::&#123;instruction::EscrowInstruction, error::EscrowError, state::Escrow&#125;;\n\nrustuse solana_program::&#123;\n    account_info::&#123;next_account_info, AccountInfo&#125;,\n    entrypoint::ProgramResult,\n    program_error::ProgramError,\n    msg,\n    pubkey::Pubkey,\n    program_pack::&#123;Pack, IsInitialized&#125;,\n    sysvar::&#123;rent::Rent, Sysvar&#125;,\n    program::invoke\n&#125;;\n&lt;!--codeï¿¼11--&gt;\n\n\nprocessor.rséœ€è¦è½¬ä»£å¸è´¦å·æ‰€æœ‰æƒï¼Œè°ƒç”¨spl-tokençš„ç›¸å…³å‡½æ•°ç”ŸæˆæŒ‡ä»¤\nä¸»è¦åŠŸèƒ½ï¼š\néªŒè¯ç”¨äºæ¥æ”¶ä»£å¸çš„è´¦å·æ˜¯å¦å­˜åœ¨\néªŒè¯äº¤æ˜“è´¦å·æ˜¯å¦å…ç§Ÿé‡‘ï¼ˆæ³¨æ„äº†è§£ç›¸å…³æ¦‚å¿µï¼‰\néªŒè¯äº¤æ˜“è´¦å·æœªåˆå§‹åŒ–è¿‡ï¼ˆæˆ‘è¿˜æ²¡ç†è§£ï¼Œè¯´æ³•æ˜¯åªèƒ½åˆå§‹åŒ–ä¸€æ¬¡ğŸ¤”ç•™ä¸€ä¸ªtodo!()åœ¨è¿™å¥½äº†ğŸ¤—ï¼‰\næŠŠäº¤æ˜“è´¦å·çš„ä¿å­˜æ•°æ®åˆå§‹åŒ–å†™å›åŒºå—é“¾ä¸­ï¼ˆå‚è§Escrow::packå‡½æ•°ï¼‰\nè½¬è®©ä¸´æ—¶ä»£å¸è´¦å·çš„æ‰€æœ‰æƒ\n\n\n\næœ¬åœ°ç¼–è¯‘éƒ¨ç½²\n\n\n\n\n\n\nWARNING\nsolana-install å·¥å…·å·²è¢«å¼ƒç”¨ï¼Œå¹¶å°†åœ¨ Solana ç‰ˆæœ¬ 1.18 ä¸å†æ”¯æŒååœæ­¢ä½¿ç”¨!\n\nå¦‚æœä½ æå‰å®‰è£…äº†ï¼Œå¹¶ä¸”å®‰è£…çš„æ—¶solana-installçš„æ›´é«˜ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼é‡è£…å§ğŸ¤—åæ­£æˆ‘é‡è£…äº†ï¼Œä¸»è¦æ˜¯åç»­ä½¿ç”¨cargo-build-bpfä¸èƒ½æ­£å¸¸è°ƒå–åˆ°å‘½ä»¤ğŸ˜¤ï¼ŒåŒæ—¶æ•™ç¨‹ä¸­ä½¿ç”¨äº†cargo build-bpf,å¾ˆå¥‡æ€ªï¼Œæˆ‘å®‰è£…äº†ä½†æ˜¯è·‘ä¸äº†è¿™ä¸ªå‘½ä»¤ï¼Œå¥½åƒæ²¡æœ‰å†™å…¥åˆ°cargoé‡Œé¢ğŸ¤”ä¹Ÿå¯èƒ½æ˜¯windowsçš„é—®é¢˜\nï¼ˆå†æ¬¡åæ§½windowsçš„æ•™ç¨‹å…¼å®¹æ€§ï¼ŒçœŸçš„çƒ‚ï¼Œæ–¹ä¾¿çš„è¿˜æ˜¯è½¬æˆ˜moc OSæˆ–è€…Linuxå§ğŸ¤—ğŸ¤—ï¼‰\n\n\n\n\n\n\n\n\n\n\n\n\nåæ§½ç»“æŸï¼æ¥ä¸‹æ¥æ˜¯æ­£ç»æ•™å­¦\n\n\n\n\n\n\n\n\n\nä»¥ä¸‹æ˜¯å‚è€ƒçš„csdnï¼š\nç¼–è¯‘åˆçº¦ï¼Œæ‰“å¼€ç»ˆç«¯åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œè¿è¡Œcargo build-bpf --manifest-path=./Cargo.toml --bpf-out-dir=dist/programå¹¶å¿½è§†é‚£äº›è­¦å‘Šï¼ˆé‚£æ˜¯ä¸‹ä¸€æ­¥ä½¿ç”¨çš„ï¼‰ã€‚ç¼–è¯‘å®Œæˆåä¼šç»™å‡ºéƒ¨ç½²å‘½ä»¤ã€‚\nå¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ã€‚æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¿è¡Œsolana-test-validatorå¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ã€‚\nè¿›è¡Œæœ¬åœ°é…ç½®ã€‚å¦å¤–æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œsolana config getçœ‹æ˜¯å¦æŒ‡å‘äº†æœ¬åœ°èŠ‚ç‚¹ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿è¡Œsolana config set --url http://localhost:8899 è¿›è¡Œè®¾ç½®ã€‚ç„¶åè¿è¡Œsolana balanceï¼Œä½ ä¼šå‘ç°ä½ æ‹¥æœ‰ 500000000 ä¸ªSOLã€‚-_- !!!\nè¿è¡Œç¼–è¯‘æ—¶ç»™å‡ºçš„éƒ¨ç½²å‘½ä»¤:\nsolana program deploy ..../escrow/target/deploy/escrow.so1æœ€åå¾—åˆ°ä¸€ä¸ªç¨‹åºIDï¼Œéœ€è¦è®°ä¸‹æ¥ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„ä¸º:HEptwBGd4ShMYP6vNCE6vsDmuG3bGzQCcRPHfapvNeys\næ¥ä¸‹æ¥ï¼Œå‡å¦‚ä½ æ˜¯windowsä¸”åœ¨è¿™éƒ¨å¤šæ¬¡é‡åˆ°å›°éš¾ï¼Œä½ å¯ä»¥çœ‹çœ‹æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼š\n\né€šè¿‡agaveçš„relaseä¸‹è½½agave-install-init[^4]ï¼Œåœ¨cmdä¸­è¿è¡Œï¼šagave-install-init-x86_64-pc-windows-msvc.exe v1.18.22 å¦‚æœå®‰è£…æ²¡é—®é¢˜ï¼Œä½ çš„agave-installå’Œcargo-build-bpféƒ½åº”è¯¥èƒ½æ­£å¸¸è¿è¡Œï¼Ÿèƒ½æ‰¾åˆ°å‘½ä»¤å°±æ²¡é—®é¢˜ç„¶åä½ å°±èƒ½æ¥ç€ä¸Šé¢ç»§ç»­è·Ÿéšæ“ä½œäº†ï¼Œè®°å¾—ç”¨cargo-build-bpf\n\nå¦‚æœæŠ¥æƒé™é—®é¢˜ï¼Œå°±ç”¨ç®¡ç†å‘˜æƒé™ï¼Œæˆ‘ä¼šåœ¨åç»­æä¾›æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼ˆä½¿ç”¨batè„šæœ¬ï¼Œè¿™æ ·ä½ åªè¦åœ¨ä½ çš„ç¼–è¾‘å™¨è‡ªå¸¦terminalè¿è¡Œäº†ï¼Œè™½ç„¶ä¼šå†å¼€ä¸€ä¸ªç»ˆç«¯ä½†æ˜¯é—®é¢˜ä¸å¤§ï¼Œå¤§å¤§ç®€åŒ–æ“ä½œäº†ï¼‰\n\nå¯¹äº†ï¼Œé¢å¤–è¯´ä¸€å¥ï¼Œæˆ‘æ²¡æœ‰çœ‹åˆ°500000000 ä¸ªSOLåœ¨æˆ‘è¯¯æ‰“è¯¯æ’å°è¯•äº†solana airdrop 2å’Œsolana airdrop 1000ä»¥åŠ solana airdrop 1000 -k id.jsonæˆ‘çš„è´¦æˆ·å‡ºç°äº†500000000 SOLä¸çŸ¥é“æ€ä¹ˆå‡ºç°çš„ï¼Œä¸è¿‡é—®é¢˜åº”è¯¥ä¸å¤§ğŸ¤—\n\nbashæ²¡æœ‰é…ç½®å¤§æ¦‚ä¼šå˜æˆè¿™æ ·\n&gt; solana balance\nError: Dynamic program error: No default signer found, run &quot;solana-keygen new -o C:\\Users\\Raphaeltop\\.config\\solana\\id.json&quot; to create a new one\n&lt;!--codeï¿¼12--&gt;\n1ã€åˆ›å»ºAliceè´¦å·å¹¶é¢†å–ç©ºæŠ•SOLä½œä¸ºæ‰‹ç»­è´¹\n2ã€éƒ¨ç½²spl-tokenåˆçº¦ï¼Œè¿™ä¸ªå·²ç»é»˜è®¤åŒ…å«åœ¨æœ¬åœ°èŠ‚ç‚¹äº†,åœ°å€ä¸º:TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DAã€‚\n3ã€éƒ¨ç½²spl-associated-token-accountåˆçº¦ï¼Œé»˜è®¤å·²æœ‰ï¼Œåœ°å€ä¸º:ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL\n4ã€å‘è¡ŒXå’ŒYä¸¤ç§ä»£å¸ã€‚\n5ã€åˆ›å»ºAliceåœ¨Xä»£å¸å’ŒYä»£å¸çš„è´¦å·ï¼ˆä¸»è´¦å·ï¼Œè¿™é‡Œä½¿ç”¨å”¯ä¸€çš„ä»£å¸å…³è”åœ°å€ï¼‰ã€‚\n6ã€ç»™Aliceå¢å‘è¶³å¤Ÿæ•°é‡çš„Xä»£å¸è¿›è¡Œæµ‹è¯•\n&lt;!--codeï¿¼13--&gt;\n\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115const &#123;    Keypair,    Transaction,    LAMPORTS_PER_SOL,    Connection,    sendAndConfirmTransaction&#125; = require(&#x27;@solana/web3.js&#x27;);const &#123;Token,ASSOCIATED_TOKEN_PROGRAM_ID,TOKEN_PROGRAM_ID&#125; = require(&#x27;@solana/spl-token&#x27;);const rpcUrl = &quot;http://localhost:8899 &quot;;const connection = new Connection(rpcUrl, &#x27;confirmed&#x27;);const initSupplyTokenX = 100000000;async function prepair() &#123;    //åˆ›å»ºAliceè´¦å·é¢†å–ç©ºæŠ•    const alice = Keypair.generate()    signer = alice;    console.log(showWallet(alice))    let  aliceAirdropSignature = await connection.requestAirdrop(        alice.publicKey,        LAMPORTS_PER_SOL,    );    await connection.confirmTransaction(aliceAirdropSignature);    let lamports = await connection.getBalance(alice.publicKey);    console.log(&quot;Alice lamports:&quot;,lamports)    //å‘è¡Œä»£å¸X    let tokenX = await Token.createMint(        connection,        alice,        alice.publicKey,        null,        9,        TOKEN_PROGRAM_ID    )    console.log(&quot;tokenX:&quot;,tokenX.publicKey.toBase58())    //åˆ›å»ºAliceçš„Xä»£å¸å…³è”è´¦å·å¹¶ä¸”å¢å‘ä»£å¸    let alice_x = await createAssociatedAccout(tokenX,alice.publicKey,alice,true)    let info = await tokenX.getAccountInfo(alice_x,&quot;confirmed&quot;)    info.owner = info.owner.toBase58()    info.mint = info.mint.toBase58()    info.address = info.address.toBase58()    console.log(&quot;alice_x:&quot;,info)    //åˆ›å»ºtokenY    let tokenY = await Token.createMint(        connection,        alice,        alice.publicKey,        null,        9,        TOKEN_PROGRAM_ID    )    console.log(&quot;tokenY:&quot;,tokenY.publicKey.toBase58())    //åˆ›å»ºaliceåœ¨tokenYçš„å…³è”è´¦å·    let alice_y = await createAssociatedAccout(tokenY,alice.publicKey,alice,false)    console.log(&quot;alice_y_publicKey:&quot;,alice_y.toBase58())&#125;//åˆ›å»ºå…³è”åœ°å€å¹¶å¢å‘ä»£å¸async function createAssociatedAccout(tokenObj,owner,signer,isMint) &#123;    //ç¬¬ä¸€æ­¥ï¼Œè®¡ç®—å…³è”åœ°å€    let associatedAddress = await getAssociatedTokenAddress(        TOKEN_PROGRAM_ID,        tokenObj.publicKey,        owner    )    //ç¬¬äºŒæ­¥ åˆ›å»ºå…³è”è´¦å·ï¼ˆæ­¤æ—¶ASSOCIATED_TOKEN_PROGRAMä¼šè‡ªåŠ¨è¿›è¡Œåˆå§‹åŒ–ï¼‰    let transaction = new Transaction()    transaction.add(        Token.createAssociatedTokenAccountInstruction(          ASSOCIATED_TOKEN_PROGRAM_ID,          TOKEN_PROGRAM_ID,          tokenObj.publicKey,          associatedAddress,          owner,          signer.publicKey,        )    );    // ç¬¬ä¸‰æ­¥ å¢å‘ä»£å¸    if(isMint) &#123;        transaction.add(            Token.createMintToInstruction(              TOKEN_PROGRAM_ID,              tokenObj.publicKey,              associatedAddress,  //æ³¨æ„è¿™é‡Œæ˜¯ç»™å…³è”åœ°å€å¢å‘              owner,              [],              initSupplyTokenX,            )        )    &#125;    // ç¬¬å››æ­¥ å‘é€äº¤æ˜“    await sendAndConfirmTransaction(        connection,        transaction,        [signer]    )    return associatedAddress&#125;async function getAssociatedTokenAddress(programId,mint,account) &#123;    let newAccount = await Token.getAssociatedTokenAddress(        ASSOCIATED_TOKEN_PROGRAM_ID, //å…³è”åœ°å€å›ºå®šå…¬é’¥        programId,      // ä»£å¸åˆçº¦å…¬é’¥        mint,            //mint(ä»£å¸)æ ‡è¯†/å…¬é’¥        account,            //ç©å®¶ä¸»è´¦å· å…¬é’¥    )    return newAccount&#125;function showWallet(wallet) &#123;    let result = [wallet.publicKey.toBase58(),Buffer.from(wallet.secretKey).toString(&quot;hex&quot;)]    return result&#125;prepair().then(() =&gt; console.log(&quot;over&quot;))\n\n\nä¸»è¦åŠŸèƒ½ï¼š\n\nåˆ›å»ºä¸€ä¸ªæ–°è´¦æˆ·aliceå¹¶è·å–airdrop\nåˆ›å»ºå’Œç®¡ç†ä»£å¸ï¼ˆtokensï¼‰\nåˆ›å»ºå…³è”çš„ä»£å¸è´¦æˆ·ï¼ˆAssociated token accountsï¼‰\nå¢å‘ä»£å¸ï¼ˆmint tokensï¼‰\n\n\nå¯¼å…¥æ¨¡å—éƒ¨åˆ†ï¼šï¼ˆè™½ç„¶è¿™éƒ¨åˆ†ä¸æ˜¯å¾ˆé‡è¦ï¼Œä½†æ˜¯é¢˜ä¸»è¿˜ä¸ç†Ÿæ‚‰ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿å›é¡¾è¿˜æ˜¯ç½—åˆ—äº†ğŸ˜ï¼‰\n\nKeypair: ç”¨äºç”Ÿæˆæ–°çš„å…¬ç§é’¥å¯¹ï¼Œä»£è¡¨ Solana ä¸­çš„ä¸€ä¸ªè´¦æˆ·ã€‚\nTransaction: è¡¨ç¤ºä¸€æ¬¡äº¤æ˜“ï¼Œå…è®¸ä½ åœ¨åŒºå—é“¾ä¸Šç»„åˆå¤šä¸ªæŒ‡ä»¤ä¸€èµ·æ‰§è¡Œã€‚\nLAMPORTS_PER_SOL: Solana ä¸Š 1 SOL çš„å•ä½ç­‰äº 10äº¿ Lamportsã€‚\nConnection: ç”¨äºè¿æ¥åˆ° Solana åŒºå—é“¾ç½‘ç»œçš„å®¢æˆ·ç«¯ã€‚\nsendAndConfirmTransaction: å‘é€å¹¶ç¡®è®¤äº¤æ˜“ã€‚\nToken: æä¾› SPL ä»£å¸ï¼ˆSolana ä¸Šçš„ä»£å¸æ ‡å‡†ï¼‰çš„ç›¸å…³æ“ä½œæ–¹æ³•ã€‚\nASSOCIATED_TOKEN_PROGRAM_ID å’Œ TOKEN_PROGRAM_ID: æ˜¯ä¸ä»£å¸è´¦æˆ·æ“ä½œç›¸å…³çš„ Solana ç¨‹åºçš„æ ‡è¯†ç¬¦\n\n\nåˆ›å»ºé“¾æ¥å’Œåˆå§‹ä¾›åº”é‡ï¼š\n\nrpcUrl: æŒ‡å®šè¿æ¥åˆ°æœ¬åœ°è¿è¡Œçš„ Solana èŠ‚ç‚¹çš„ RPC URLã€‚\nconnection: ä¸ Solana åŒºå—é“¾çš„è¿æ¥å¯¹è±¡ã€‚\ninitSupplyTokenX: åˆå§‹ä¾›åº”é‡ï¼Œè¡¨ç¤º TokenX å‘è¡Œçš„åˆå§‹æ•°é‡ã€‚\n\n\nprepair å‡½æ•°ä¸»å‡½æ•°ï¼Œæ‰§è¡Œä»£å¸åˆ›å»ºå’Œè´¦æˆ·ç®¡ç†æ“ä½œ\n\nåˆ›å»º Alice è´¦å·:\n\nKeypair.generate() åˆ›å»ºä¸€ä¸ªæ–°çš„å¯†é’¥å¯¹ï¼ˆå³ Alice çš„è´¦æˆ·ï¼‰ã€‚\nè¯·æ±‚ç©ºæŠ•ï¼ˆAirdropï¼‰1 SOL ç»™ Alice çš„è´¦æˆ·ï¼Œå¹¶ç¡®è®¤è¿™ç¬”äº¤æ˜“ã€‚\n\n\n**å‘è¡Œä»£å¸TokenX**ï¼š\n\nToken.createMint: åˆ›å»ºä¸€ä¸ªæ–°çš„ä»£å¸ï¼ˆTokenXï¼‰ã€‚\nconnection: ç”¨äºé“¾ä¸Šæ“ä½œçš„è¿æ¥å¯¹è±¡ã€‚\nalice: ä»£å¸åˆ›å»ºè€…çš„ Keypairï¼ˆå³ Aliceï¼‰ã€‚\nalice.publicKey: ä»£å¸çš„åˆå§‹æˆæƒè€…ã€‚\nnull: è¡¨ç¤ºä»£å¸ä¸å…è®¸å†»ç»“è´¦æˆ·ã€‚\n9: ä»£å¸çš„å°æ•°ä½æ•°ï¼ˆè¡¨ç¤ºä»£å¸çš„ç²¾åº¦ï¼Œå’Œ SOL ä¸€æ ·æœ‰9ä¸ªå°æ•°ä½ï¼‰ã€‚\nTOKEN_PROGRAM_ID: ä»£å¸ç¨‹åºçš„æ ‡è¯†ç¬¦ã€‚\n\n\n\n\nåˆ›å»ºAliceçš„ä»£å¸Xå…³è”è´¦æˆ·å¹¶å¢å‘ä»£å¸\n\njslet alice_x = await createAssociatedAccout(tokenX,alice.publicKey,alice,true)\n&lt;!--codeï¿¼15--&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\nå…³é”®ç‚¹æ€»ç»“\nAliceè´¦æˆ·ï¼šä½œä¸ºä¸ªäººè´¦æˆ·ï¼Œå®ƒæŒæœ‰SOLå’Œä»£å¸é“¸é€ æƒé™ï¼Œæ§åˆ¶TokenXå’ŒTokenYçš„å¢å‘ã€‚\nTokenXå’ŒTokenYä»£å¸ï¼šç”±Aliceè´¦æˆ·é“¸é€ ï¼Œå¯ä»¥åœ¨ç›¸å…³çš„å…³è”è´¦æˆ·ä¸­æŒæœ‰ã€‚\nå…³è”è´¦æˆ·ï¼ˆATAï¼‰ï¼šä¸“é—¨ç”¨äºæŒæœ‰æŸç§ç‰¹å®šä»£å¸ï¼ˆå¦‚TokenXæˆ–TokenYï¼‰çš„è´¦æˆ·ï¼Œç”±å…¶å…³è”çš„ç”¨æˆ·è´¦æˆ·ï¼ˆAliceè´¦æˆ·ï¼‰æ§åˆ¶ã€‚\nä»£å¸ä¸å…³è”è´¦æˆ·çš„å…³ç³»ï¼šæ¯ä¸ªå…³è”è´¦æˆ·ï¼ˆATAï¼‰åªèƒ½æŒæœ‰ä¸€ç§ç‰¹å®šçš„ä»£å¸ï¼Œä¸åˆ›å»ºè¯¥å…³è”è´¦æˆ·çš„ä¸»è´¦æˆ·ï¼ˆå¦‚Aliceï¼‰æœ‰ç›´æ¥çš„å…³è”å…³ç³»ã€‚\n\n\nè®©Aliceè´¦æˆ·å¯ä»¥ç®¡ç†å¤šä¸ªä»£å¸ï¼Œå¹¶ä½¿ç”¨ç›¸å…³çš„å…³è”è´¦æˆ·æ¥åˆ†åˆ«æŒæœ‰å’Œæ“ä½œè¿™äº›ä»£å¸\n\n\n::: warning\næ³¨æ„ï¼Œå¤§æ¦‚ç‡æ˜¯ç‰ˆæœ¬æ›´æ–°çš„é—®é¢˜ï¼Œè¿™ä»½ä»£ç å·²ç»è·‘ä¸äº†äº†ğŸ¤—åšä¸»å·²ç»å„ä½å°è¯•äº†ï¼ŒèŠ±äº†å¾ˆå¤šçš„æ—¶é—´ï¼Œç»“è®ºæ˜¯è·‘ä¸äº†ã€‚è¿™è¾¹å‡†å¤‡æ¢å»è°ƒæ¡†æ¶äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæŠŠåç»­çœ‹å®Œçš„ï¼ŒåŸºç¡€è¿˜æ˜¯è¦çœ‹çœ‹çš„ğŸ“–\n:::\næµ‹è¯•æ‰˜ç®¡åˆçº¦åˆå§‹åŒ–\n\n\n\n\n\n\n\n\n1ã€åˆ›å»ºä¸€ä¸ªè¢«tokenåˆçº¦æ‹¥æœ‰çš„ç©ºçš„è´¦å·2ã€å°†è¿™ä¸ªç©ºçš„è´¦å·åˆå§‹åŒ–ä¸ºAliceçš„Xä»£å¸è´¦å·ï¼ˆä¸´æ—¶è´¦å·ï¼‰3ã€Aliceå°†å¥¹çš„ä»£å¸Xä»ä¸»è´¦å·è½¬ç§»åˆ°ä¸´æ—¶è´¦å·4ã€åˆ›å»ºä¸€ä¸ªè¢«æ‰˜ç®¡åˆçº¦æ‹¥æœ‰çš„ç©ºè´¦å·5ã€å°†è¿™ä¸ªç©ºè´¦å·åˆå§‹åŒ–ä¸ºäº¤æ˜“çŠ¶æ€è´¦å·å¹¶ä¸”å°†Aliceçš„ä¸´æ—¶Xä»£å¸è´¦å·è½¬ç§»åˆ°PDAï¼ˆç¨‹åºæ´¾ç”Ÿè´¦å·ï¼‰ã€‚\næ³¨æ„ï¼Œåˆçº¦éƒ¨ç½²æ—¶çš„åœ°å€å…¶å®åœ¨ç¼–è¯‘åæ˜¯å¯ä»¥æ‹¿åˆ°çš„ï¼Œä½¿ç”¨solana address -k .../....soå°±å¯ä»¥è·å–äº†\nåœ¨/test/ç›®å½•ä¸‹å»ºç«‹init.js\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108const &#123;    Keypair,    PublicKey,    Transaction,    TransactionInstruction,    SystemProgram,    Connection,    SYSVAR_RENT_PUBKEY,    sendAndConfirmTransaction&#125; = require(&#x27;@solana/web3.js&#x27;);const &#123;Token,TOKEN_PROGRAM_ID&#125; = require(&#x27;@solana/spl-token&#x27;);const BufferLayout = require(&quot;buffer-layout&quot;);const BN = require(&quot;bn.js&quot;);const rpcUrl = &quot;http://localhost:8899 &quot;;const connection = new Connection(rpcUrl, &#x27;confirmed&#x27;);//æˆ‘ä»¬çš„æ‰˜ç®¡ç¨‹åºåœ°å€const escrowProgramId = new PublicKey(&quot;HEptwBGd4ShMYP6vNCE6vsDmuG3bGzQCcRPHfapvNeys&quot;)//ä»ç§é’¥ä¸­æ¢å¤aliceçš„é’±åŒ…const alice_privateKey = &quot;49372f691baa9cb4f6d5f485e43b685adb26055cdc545728bd2ff808d0bf92ea870d687c5de0f7eac13cd6050b1c78e23345575ca4b2fc241d65705983015eb1&quot;const alice = Keypair.fromSecretKey(Uint8Array.from(Buffer.from(alice_privateKey, &#x27;hex&#x27;)))//ä»ä»£å¸Xåœ°å€ä¸­æ¢å¤ä»£å¸Xå¯¹è±¡const token_x = new PublicKey(&quot;FMYttGRGuYCrgqCRZLhLoUESqo9Sfe87DKdH7JLZGB6G&quot;)const tokenX = new Token(connection,token_x,TOKEN_PROGRAM_ID,alice)//Aliceåœ¨ä»£å¸Xçš„å…³è”è´¦å·ï¼ˆå…¬é’¥ï¼‰const alice_x = new PublicKey(&quot;6fBN3uzsDKfG2nDLnpP4NknMocQX85AB1vqCWfXbW9os&quot;)const alice_y = &quot;Bu8Heft6Lsih32Z6yaVFQqVndDtzAmJdMS8friSLb59w&quot;const publicKey = (property) =&gt; &#123;    return BufferLayout.blob(32, property);&#125;;  const uint64 = (property) =&gt; &#123;    return BufferLayout.blob(8, property);&#125;;const ESCROW_ACCOUNT_DATA_LAYOUT = BufferLayout.struct([    BufferLayout.u8(&quot;isInitialized&quot;),    publicKey(&quot;initializerPubkey&quot;),    publicKey(&quot;initializerTempTokenAccountPubkey&quot;),    publicKey(&quot;initializerReceivingTokenAccountPubkey&quot;),    uint64(&quot;expectedAmount&quot;),]);const SWAP_AMOUNT = 1000;    //è®¡åˆ’äº¤æ˜“çš„Xæ•°é‡const expectedAmount = 1200; //æœŸæœ›å¾—åˆ°çš„Yæ•°é‡const Escrow_Size = ESCROW_ACCOUNT_DATA_LAYOUT.span; //105ï¼Œæ‰˜ç®¡åˆçº¦ä¸­äº¤æ˜“è´¦å·æ•°æ®å¤§å°ï¼Œå…¶å®æˆ‘ä»¬åœ¨åˆçº¦state.rsä¸­å·²ç»çŸ¥é“å¤§å°äº†async function init() &#123;    //åˆ›å»ºAliceåœ¨Xä»£å¸çš„ä¸´æ—¶è´¦å·,è¿™é‡Œä½¿ç”¨SDKè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºäº†ã€‚    let temp_account = await tokenX.createAccount(alice.publicKey)    //è½¬ç§»Xä»£å¸æŒ‡ä»¤    const transaction = new Transaction().add(        Token.createTransferInstruction(          TOKEN_PROGRAM_ID,          alice_x,          temp_account,          alice.publicKey,          [],          SWAP_AMOUNT,        ),    );    const escrowAccount = Keypair.generate() //äº§ç”Ÿä¸€ä¸ªéšæœºå…¬/ç§é’¥å¯¹    console.log(&quot;escrowAccount:&quot;,escrowAccount.publicKey.toBase58())    //åˆ›å»ºæ‰˜ç®¡è´¦å·æŒ‡ä»¤    const createEscrowAccountIx = SystemProgram.createAccount(&#123;        space: Escrow_Size,        lamports: await connection.getMinimumBalanceForRentExemption(Escrow_Size, &#x27;confirmed&#x27;),        fromPubkey: alice.publicKey,        newAccountPubkey: escrowAccount.publicKey,        programId: escrowProgramId    &#125;);    transaction.add(createEscrowAccountIx)    //åˆå§‹åŒ–æ‰˜ç®¡è´¦å·æŒ‡ä»¤    const initEscrowIx = new TransactionInstruction(&#123;        programId: escrowProgramId,        keys: [            &#123; pubkey: alice.publicKey, isSigner: true, isWritable: false &#125;,            &#123; pubkey: temp_account, isSigner: false, isWritable: true &#125;,            &#123; pubkey: alice_y, isSigner: false, isWritable: false &#125;,            &#123; pubkey: escrowAccount.publicKey, isSigner: false, isWritable: true &#125;,            &#123; pubkey: SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false&#125;,            &#123; pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false &#125;,        ],        data: Buffer.from(Uint8Array.of(0, ...new BN(expectedAmount).toArray(&quot;le&quot;, 8)))    &#125;)    transaction.add(initEscrowIx)    //å‘é€äº¤æ˜“    await sendAndConfirmTransaction(        connection,        transaction,        [alice,escrowAccount] //è¿™é‡Œè¦åˆ›å»ºescrowAccountï¼Œæ‰€ä»¥å®ƒå¿…é¡»ç­¾å    )    const encodedEscrowState = (await connection.getAccountInfo(escrowAccount.publicKey,&#x27;confirmed&#x27;)).data;    const decodedEscrowState = ESCROW_ACCOUNT_DATA_LAYOUT.decode(encodedEscrowState)    let info = &#123;        isInitialized:decodedEscrowState.isInitialized === 1,        initializerPubkey:new PublicKey(decodedEscrowState.initializerPubkey).toBase58(),        initializerTempTokenAccountPubkey:new PublicKey(decodedEscrowState.initializerTempTokenAccountPubkey).toBase58(),        initializerReceivingTokenAccountPubkey:new PublicKey(decodedEscrowState.initializerReceivingTokenAccountPubkey).toBase58(),        expectedAmount:new BN(decodedEscrowState.expectedAmount, 10, &quot;le&quot;).toNumber()    &#125;    console.log(&quot;EscrowState:&quot;,info)&#125;init().then(() =&gt; console.log(&quot;over&quot;))\n\n12yarn add buffer-layoutyarn add bn.js\n\nåé¢æ²¡ä»€ä¹ˆé‡è¦å†…å®¹äº†âš™ï¸è¯·æœŸå¾…åç»­çš„æ–°å†…å®¹ğŸ¤—\n","slug":"Solana-coding-learning","date":"2024-09-01T14:56:16.000Z","categories_index":"Rust,åŒºå—é“¾","tags_index":"rust,solana","author_index":"RaphaelNY"},{"id":"8c17d3487aed17c3a795749d1b71c388","title":"ç¢ç¢å¿µçš„emoæƒ…ç»ª","content":"","slug":"emo-time","date":"2024-04-27T16:00:00.000Z","categories_index":"Emo","tags_index":"emo","author_index":"RaphaelNY"},{"id":"3b9e33d00820bf2a8cfa74fde48d213b","title":"tauriä¸ªäººå…¥é—¨å»ºè®®","content":"å‰è¨€\n\n\n\n\n\nTIP\nâœ¨å¦‚æœä½ æ²¡æœ‰æ¥è§¦è¿‡ç›¸å…³çš„å‰ç«¯å†…å®¹ï¼ˆç®€å•ç†è§£ä¸ºå°±æ˜¯ä½ æ”¾è¿™ä¹ˆå¤šä¸œè¥¿åœ¨è¿™æˆ‘ä¹Ÿä¸çŸ¥é“è¿™äº›å‰ç«¯æ€ä¹ˆç©ğŸ˜¤ï¼‰ã€‚æˆ‘å¼ºçƒˆå»ºè®®ä½ é€šè¿‡å®˜æ–¹æ–‡æ¡£ä¸­çš„è‡ªä¸»æ„å»ºè€Œä¸æ˜¯ä½¿ç”¨$cargo cteate-tauri-appæ¥è¿›è¡Œå…¥é—¨ğŸ¦€ï¼ˆåšä¸»åœ¨æœ€å¼€å§‹çš„æ—¶å€™å°è¯•äº†å®ƒã€‚å®ƒä¼šä¸€æ¬¡æ€§ä¸ºä½ æä¾›æ•´ä¸ªå®Œæ•´çš„ä»£ç æ¡†æ¶ï¼Œä¸»è¦åœ¨äºå‰ç«¯æ¡†æ¶ğŸ¤”ä½†æ˜¯å‡å¦‚ä½ å¸Œæœ›è¾¹å­¦è¾¹åšï¼Œæˆ‘è¿˜æ˜¯å»ºè®®ä»è‡ªå»ºå¼€å§‹ğŸ˜æ¯•ç«Ÿä¸€ä¸‹å­æ¥è§¦ä¸€å¤§å †çš„ä»£ç ï¼Œå­¦ä¹ æ›²çº¿çœŸçš„å¾ˆé«˜ğŸ¥²ï¼‰\n\nå®‰è£…tauriæ— è®ºä½ å¸Œæœ›å¦‚ä½•å¼€å§‹ä½ çš„å·¥ä½œã€‚tauriä¾èµ–æ˜¯å¿…é¡»å®‰è£…çš„ã€‚ä½ å¯ä»¥ç›´æ¥ctrl+Ræ‰“å¼€cmdã€‚è¾“å…¥ï¼š\n1cargo install tauri-cli\n\nå®‰è£…æ—¶é—´æ¯”è¾ƒé•¿ï¼Œä½ å¯èƒ½è¦ç¨ç­‰ä¸€ä¸‹ã€‚æ³¨æ„ä½ çš„æ€æ¯’è½¯ä»¶ã€‚åšä¸»åœ¨å®‰è£…çš„æ—¶å€™å°±ç¢°åˆ°æ€æ¯’è½¯ä»¶æ€æ­»å®‰è£…è¿‡ç¨‹ä¸­è£…å…¥çš„ä¸€äº›ä¾èµ–ï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯è¿ˆå…‹è²ğŸ˜¡ä½“éªŒçœŸçš„æœ‰ç‚¹çƒ‚äº†ã€‚æ·»åŠ ç™½åå•æ€ä¹ˆä¹ŸåŠ ä¸è¿›å»ï¼Œè€Œä¸”ä¸èƒ½ç›´æ¥å¤åˆ¶è·¯å¾„æ¥å¿«é€Ÿç§»åŠ¨åˆ°æƒ³è¦çš„è·¯å¾„ğŸ˜¤ï¼‰ï¼Œè¢«ç‹ ç‹ çš„æ¶å¿ƒåˆ°äº†ã€‚\n\n\n\n\n\n\nTIP\nåœ¨æ‰€æœ‰çš„å·¥ä½œä¹‹å‰ï¼Œä½ å¿…é¡»å®‰è£…rustå’Œä¸€äº›ç›¸å…³çš„å†…å®¹ï¼Œè¿™äº›è¯·å‚è€ƒä¸€äº›å…¶ä»–çš„æ–‡ç« ï¼Œæ¯”å¦‚å®‰è£… Rust ç¯å¢ƒ - Rustè¯­è¨€åœ£ç»(Rust Course)\n\n\næ–°å»ºæ–‡ä»¶å¤¹âœ¨å‡å¦‚ä½ æ˜¯githubçš„å¸¸å®¢ã€‚æˆ‘çš„å»ºè®®æ˜¯åœ¨githubä¸Šåˆ›å»ºé¡¹ç›®ã€‚æ·»åŠ READMEå’ŒLICENSEï¼ˆä¸ä¼šæœ‰äººä¸å–œæ¬¢ä¸ºè‡ªå·±çš„é¡¹ç›®æ·»åŠ READMEå§ğŸ˜ºï¼‰ç„¶åç›´æ¥é€šè¿‡git cloneåˆ°æœ¬åœ°ã€‚æ¥ä¸‹æ¥åœ¨é¡¹ç›®è·¯å¾„ä¸‹æ‰“å¼€ç»ˆç«¯\n12mkdir uicargo tauri init\n\n\næ‚¨åº”ç”¨çš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿè¿™å°†ä¼šæ˜¯æ‚¨æ‰“åŒ…åå’Œæ“ä½œç³»ç»Ÿä¼šè°ƒç”¨çš„åº”ç”¨åç§°ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„å¡«å†™ä»»ä½•æ‚¨æƒ³è¦çš„åç§°ã€‚\n\nçª—å£æ ‡é¢˜å«ä»€ä¹ˆï¼Ÿè¿™å°†ä¼šæ˜¯æ‚¨ä¸»çª—å£çš„é»˜è®¤æ ‡é¢˜ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„å¡«å†™ä»»ä½•æ‚¨æƒ³è¦çš„åç§°ã€‚\n\nå‰ç«¯é¡µé¢èµ„æº (HTML&#x2F;CSS&#x2F;JS) ç›¸å¯¹äº &lt;current dir&gt;/src-tauri/tauri.conf.json æ–‡ä»¶å°†è¢«åˆ›å»ºçš„ä½ç½®ï¼Ÿ\nè¿™æ˜¯ç¯å¢ƒæ—¶tauriåŠ è½½webå‰ç«¯èµ„æºçš„ç›®å½•ï¼ˆä½¿ç”¨..&#x2F;ui)\n\nå¼€å‘ç¯å¢ƒæ—¶çš„åŠ è½½è·¯å¾„?\nå¯ä»¥æ˜¯ä¸€ä¸ªç½‘ç»œåœ°å€ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼ˆä½¿ç”¨..&#x2F;uiï¼‰\n\nä½ å°†ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤æ¥å¼€å‘å‰ç«¯é¡µé¢ï¼Ÿ\nè¿™æ˜¯å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨çš„å‘½ä»¤(æˆ‘å»ºè®®ç•™ç©º)\n\nä½ å°†ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤æ¥æ„å»ºå‰ç«¯é¡µé¢ï¼Ÿ\nè¿™æ˜¯æ„å»ºå‰ç«¯æ–‡ä»¶çš„å‘½ä»¤ï¼ˆæˆ‘å»ºè®®ç•™ç©ºï¼‰\n\n\nç„¶ååœ¨uiç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ªç®€å•çš„index.htmlæ–‡ä»¶\n1234567891011&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;title&gt;æ–‡æ¡£&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;h1&gt;è¿™æ˜¯æ¥è‡ª Tauri çš„æ¬¢è¿ï¼&lt;/h1&gt;  &lt;/body&gt;&lt;/html&gt;\n\nâœ¨åˆ°æ­¤ï¼Œä½ å°±å®Œæˆäº†æ‰€æœ‰åŸºç¡€å®‰è£…ã€‚å¯ä»¥å¼€å§‹ä½ çš„æ„ç­‘äº†ã€‚\n\n\n\n\n\n\nTIP\nä¹Ÿè®¸åœ¨è¿™ä¹‹å‰ä½ åº”è¯¥è¿è¡Œè¿™ä¸¤æ®µä»£ç \n12cargo tauri buildcargo tauri dev\n\nåœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸‹ã€‚ç¬¬ä¸€æ¬¡ç¼–è¯‘çš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿\nå‡å¦‚ä½ è¿è¡Œçš„æ—¶å€™äº§ç”ŸæŠ¥é”™äº†ï¼Œé‚£ç§å¾ˆå¥‡æ€ªçš„æŠ¥é”™ã€‚æˆ‘æ¨èæ£€æŸ¥ä¸€ä¸‹tauri.conf.jsonä¸­çš„buildå­—æ®µä¸­è¿™ä¸¤ä¸ªå­—æ®µæ˜¯å¦ä¸ºç©ºã€‚\n12345678&#123;&quot;build&quot;: &#123;\t&quot;beforeBuildCommand&quot;: &quot;&quot;,\t&quot;beforeDevCommand&quot;: &quot;&quot;ï¼Œ\t...\t&#125;,...&#125;\n\nä¸ªäººæ„Ÿè§‰ï¼Œå¦‚æœä½ ä¹ æƒ¯ä½¿ç”¨cargoè¿›è¡ŒåŒ…ç®¡ç†ï¼Œè¿™æ ·åšæ˜¯æœ€æ–¹ä¾¿çš„ğŸ˜ºã€‚\n\n\nâœ¨å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨$cargo cteate-tauri-appæ¥å¼€å§‹ä½ çš„å·¥ä½œï¼Œè¿™ç§æ–¹å¼æ›´åŠ ç®€å•å¿«æ·ï¼Œç›¸å½“äºç›´æ¥ä¸‹è½½æ¨¡æ¿æ¡†æ¶\nâœ¨åˆ°æ­¤ï¼Œä½ åº”è¯¥èƒ½å¤Ÿå®Œæˆtauriçš„åˆæ­¥å®‰è£…ã€‚é€šè¿‡$cargo tauri devæ‰“å¼€ä½ æ‰€å®‰è£…çš„æ¨¡æ¿ç¨‹åºğŸ˜\nğŸ¤”å¦‚æœä½ å‡ºç°äº†ä»€ä¹ˆå¥‡æ€ªçš„é—®é¢˜ä¹Ÿå¯ä»¥è·Ÿæˆ‘åˆ†äº«ğŸ¤”\n","slug":"tauri-start-tutorial","date":"2024-04-27T12:25:49.000Z","categories_index":"Rust,tauri","tags_index":"rust,tauri","author_index":"RaphaelNY"},{"id":"cb74cf4ec6063240bdd2492df0bbdf14","title":"Rust desktop application","content":"Rust Desktop Application Development Practiceåœ¨è¿™ä¸€ç¯‡ä¸­å‡†å¤‡è®°å½•ä¸€ä¸‹æœ¬æ­¤æ¬¡é¡¹ç›®ä»é€‰æ‹©åˆ°æ„ç­‘å®ç°çš„å„ç§å¿ƒè·¯å†ç¨‹ã€‚è€Œå…·ä½“é‡åˆ°çš„é—®é¢˜å’Œæ³¨æ„åº”è¯¥ä¼šå•ç‹¬å¼€ä¸€ç¯‡æ¥è®°å½•ã€‚\n\noriginè¿™ä¸¤å¤©çœ‹åˆ°äº†è¿™ä¸ªè§†é¢‘ğŸ“ºï¼Œå…³äºä½¿ç”¨tauri+åç«¯RustğŸ¦€+æ•°æ®åº“SurrealDBå®ç°çš„ä¸€ä¸ªæ¡Œé¢åº”ç”¨ã€‚\næ°å¥½æœ€è¿‘æ­£åœ¨å­¦ä¹ rsutğŸ¦€å’Œæ•°æ®åº“çš„ç›¸å…³çŸ¥è¯†ï¼Œæ‰€ä»¥æƒ³è¦åˆ¶ä½œä¸€ä¸ªç±»ä¼¼çš„âœ¨æ¡Œé¢åº”ç”¨ã€‚å‰ç«¯ä½¿ç”¨ä»€ä¹ˆè¿˜æ²¡æœ‰ç¡®å®šä¸‹æ¥ğŸ¤”ã€‚åç«¯å’Œæ•°æ®åº“å‡†å¤‡ä½¿ç”¨RustğŸ¦€å’ŒSurrealDBã€‚æ¥ä¸‹æ¥å‡†å¤‡å¼€è¿™ä¸ªå‘ğŸ˜ğŸ˜\n\n\n\n\n\n\nTIP\nâœ¨[ä½¿ç”¨Rustã€Tauriå’ŒSurrealDBæ„å»ºä»¤äººæƒŠå¹çš„æ¡Œé¢åº”ç”¨ç¨‹åº]ä¸­å­—\n\ndate: 2024-04-26\n\nbuild a tauri appâœ¨ç»è¿‡è®¨è®ºï¼Œæˆ‘ä»¬æœ€ç»ˆå†³å®šä½¿ç”¨tauriæ¥ä½œä¸ºæˆ‘ä»¬çš„å·¥å…·è¿›è¡Œæˆ‘ä»¬çš„appæ„ç­‘ğŸ˜\nâœ¨ä¹Ÿè®¸æˆ‘ä»¬çš„å‰ç«¯é€‰æ‹©éå¸¸æ„šè ¢ã€‚ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„å‰ç«¯uièƒ½å¤Ÿå®ç°æˆ‘ä»¬çš„ä¸€äº›å¼‚æƒ³å¤©å¼€ğŸ§ \nâœ¨æœ€ç»ˆé€‰æ‹©æœ€ä¸ºåŸºç¡€çš„ä½¿ç”¨HTMLã€CSSã€JavaScriptæ¥ä½œä¸ºæˆ‘ä»¬çš„å‰ç«¯è¯­è¨€å®ç°ğŸ¤” \nproject introduce\né¡¹ç›®åï¼šLumijade\næœ¬æ¬¡é¡¹ç›®å°†ç”±æˆ‘ä»¬ç»„ç»‡**VernunftIstWirklich** ä¸­çš„ä¸‰ä¸ªäººå…±åŒå¼€å‘ğŸ’•\n\nâ€”- å¾…ç»­ â€”-\ndate: 2024-04-27\n","slug":"Rust-desktop-application","date":"2024-04-26T15:07:08.000Z","categories_index":"Rust,tauri","tags_index":"rust,SurrealDB,tauri","author_index":"RaphaelNY"},{"id":"f8b5cac907ef39197862c4a0ab4ae287","title":"Welcome to my blog","content":"welcome to my blogå¸Œæœ›æ¯ä¸€ä½åˆ°æ¥çš„è®¿å®¢éƒ½èƒ½å¤Ÿå­¦ä¹ åˆ°ï¼Œæˆ–è€…äº†è§£åˆ°æœ‰è¶£çš„ä¸œè¥¿ğŸ˜ğŸ˜\næˆ‘ä¹Ÿä¼šå°½æˆ‘æ‰€èƒ½çš„æ›´æ–°æœ‰è¶£çš„å†…å®¹ï¼ğŸ˜ŠğŸ˜Š\nå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æœ¬ç¯‡æ–‡ç« çš„è¯„è®ºä¸­æå‡ºæ‰¹è¯„å»ºè®®ğŸ˜£ã€‚æˆ–è€…ä½ å¸Œæœ›æˆ‘å»å­¦ä¹ äº†è§£ä»€ä¹ˆå†…å®¹ğŸ¤”\nå½“ç„¶ï¼Œç”±äºæ˜¯å­¦ç”Ÿçš„é—®é¢˜ğŸ§‘â€ğŸ“ï¼Œæˆ‘çš„æ›´æ–°æ˜¯ä¸å®šæœŸçš„å“ŸğŸ˜˜\n","slug":"Welcome-to-my-blog","date":"2024-04-26T03:23:27.000Z","categories_index":"announcement","tags_index":"announcement","author_index":"RaphaelNY"}]